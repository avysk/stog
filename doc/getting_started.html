<page title="Getting started"
navbar-doc="active"
>
<prepare-toc depth="1">
<toc>Sections:</toc>

<section name="principle" title="Principle">
<p>
When launched on a given root directory, <icode>stog</icode> will read all files
and directories
from this starting point and generate the same hierarchy in the output directory.
</p>
<p>
Some of the files will be read as <i>elements</i>, i.e. xml files which will
be processed through a templating engine to produce the final file.
</p>
<p>
The <icode>.stog</icode> directory in the given root directory contains the
templates (in directory <icode>templates</icode>) and the
<icode>config</icode> file, containing stog configuration. In this file,
using regular expressions, one can indicate which files must be ignored,
and which files are elements. Files not being ignored nor being elements
will be copied by <icode>stog</icode> in the target directory.
</p>
<p>
Here is an example of <icode>.stog/config</icode> file:
</p>
<hcode lang="ocaml" defer_="1"><include file="../config" raw="true"/></hcode>
<p>
A default file is generated by <icode>stog</icode> if it does not exist.
</p>
<p>
When launched, <icode>stog</icode> performs the following actions:
</p>
<ol>
<li>Read the given directory hierarachy;</li>
<li>Create the output directory;</li>
<li>Generate element files in this directory;</li>
<li>Copy all other files in the target directory, of course
  keeping the source directory structure.</li>
</ol>
</section>

<section name="elements" title="Stog elements">
<p>
An element is an Xml tree, defined in a file matched by the regular expressions
given in the configuration file. It has one of the following forms. First form:
</p>
<hcode lang="xml">
<![CDATA[<type title="Element title"
 attribute="value"
 attribute2="value2"
 ...
>
Here is the body of the element.
</type>
]]>
</hcode>
<p>Second form, almost the same, except that <icode>with-contents="true"</icode>
indicates that more attributes are given in subnodes, and the body is in the
<icode>contents</icode> subnode:
</p>
<hcode lang="xml">
<![CDATA[<type title="Element title"
 with-contents="true"
 attribute="value"
 ...
>
 <attribute2>value2</attribute2>
 ...
 <contents>Here is the body of the element.</contents>
</type>
]]>
</hcode>
<p>
<icode>type</icode> can be any string (like "post", "page", ...) and defines the type
of the element. This allows different treatements according to the element type.
</p>
<p>
You can specify any attribute for an element. Some attributes are used
internally:
</p>
<ul>
<li><b>title</b>: this is the title of the element; use <icode>&lt;elt-title/&gt;</icode>
in templates to access it,</li>
<li><b>keywords</b>: the list of comma-separated keywords associated to the element;
use <icode>&lt;elt-keywords/&gt;</icode> in templates to insert the list of keywords
with links to by-keyword index,</li>
<li><b>topics</b>: same as keywords, but for topics (access with <icode>&lt;elt-topics/&gt;</icode>),</li>
<li><b>date</b>: the element date, used for sorting in list. The date in specified in
the form <i>YYYY/MM/DD</i>. Use <icode>&lt;elt-date/&gt;</icode> in templates to insert it,</li>
<li><b>published</b>: can be set to <i>false</i> to prevent the element from being generated;
useful when an element is not ready yet for publication,</li>
<li><b>sets</b>: a comma-separated list of set names; sets can be used to list element
belonging to a set,</li>
<li><b>language-dep</b>: can be set to <i>false</i> to indicate that this page is not
language dependent, when generating multi-language sites (this affects to name of the
generated file).</li>
</ul>
<p>
Any other attribute will be available by its name in the environment when processing the template
associated to the element type. The element type can be accessed with <icode>&lt;elt-type/&gt;</icode>.
</p>
<p>
To generate the file corresponding to an element, <icode>stog</icode> will use the type of
the element (for example "post") to load the associated template (for example "post.tmpl" in
the templates directory).
</p>
<p>You can have a look at the source of the pages of this site at the bottom of each page.
The sources of this site can be a good starting point. You can browse it in the
<ext-a href="https://github.com/zoggy/stog/tree/master/doc">doc directory of the
distribution</ext-a>.
</p>
</section>

<section name="mainelement" title="Stog main element">
<p>
One element is called the main element. This element is a regular
element with the <icode>main</icode> attribute set to "true". There can be only
one main element.
</p>
<p>
Some attributes of this main element are used to specify site-wide information:
</p>
<ul>
<li><b>title</b>: The title of the blog is the same as this element and can be accessed
with &lt;site-title/&gt; in templates,</li>
<li><b>stog-site-description</b>: A short description of the site; use &lt;site-description/&gt;
to access it in templates;</li>
<li><b>stog-site-url</b>: The base url of the site, used to forge urls when generating pages;
use &lt;site-url/&gt; to insert it in templates,</li>
<li><b>stog-site-email</b>: A contact email for the site, accessible with &lt;site-email/&gt;,</li>
<li><b>stog-rss-length</b>: The default length of RSS feeds.</li>
</ul>
<p>
In the main element, any attribute beginning with "stog-" will be used as global attribute
and accessible in all templates by its name. Other attributes are associated to the element only.
</p>
</section>

<section name="running" title="Running Stog">
<p>
To compile your web site, use the following command:
<command-line><![CDATA[stog <root-directory>]]></command-line>
</p>
<p>Stog will generate your web site in <icode>./stog-output</icode>,
except if you use the <icode>-d</icode> option to specify another
output directory.
</p>
<p>You can specify a template directory with the <icode>--tmpl</icode>
option. By default, the templates are searched in the <icode>.stog/templates</icode> directory
of the specified root directory.
</p>
<p>
It is possible to give more than one directory to <icode>stog</icode>. In this case,
all pages and articles are merged as if all were defined in the last directory
given. It may be useful to gather blogs or page to generate one big site. Or not.
</p>
<p>The <icode>--site-url</icode> option is used to override the <icode>stog-site-url</icode>
field of the main element. It it useful to generate a local site, for example
<command-line>stog --site-url file:///tmp/website your-directory</command-line>
to test your site locally with correct links.
</p>
<p>The <icode>--plugin</icode> option makes <icode>stog</icode> dynamically
load the given OCaml object file. The loaded plugin can define new functions
to associate to some tags, or even override some pre-defined functions.
See <page href="plugins"/>.
</p>
<p>
If a plugin was installed with ocamlfind, the <icode>--package</icode> option can be used
to specify a list of comma-separated packages to load. <icode>ocamlfind</icode> will
then be used to get the location and required files to load these packages, in bytecode
for <icode>stog.byte</icode> or native-code for <icode>stog</icode>.
</p>
<p>At last, the <icode>--lang</icode> option is used to generate the website
for one language. By default, the only known languages are "en" and "fr".
If you use the <icode>--lang en</icode> option, then pages will be generated
in <icode>.en.html</icode> files and all "fr" nodes will be removed.
Then you can run <icode>stog</icode> with the <icode>--lang fr</icode>
to generate the "fr" part of your web site.
</p>
<!--
<p>
If you need more languages, just define "stog-languages" in the main element
this way:
</p>
<hcode><![CDATA[<type main="true" ... stog-languages="es,de,fr,en">...</type>]]></hcode>
<p>This makes &lt;languages/&gt; returning the list of languages, and it is used by
the provided
-->
</section>

<section name="templates" title="Evaluation and templating">
<p>
The final file for each element is build this way
</p>
<ol>
<li>The template file is loaded, according to the type of the element; for example,
if the element has type "page", then a template <icode>page.tmpl</icode> will
be looked for;</li>
<li>An environment is build, containing the <a href="#mainelement">site-wide attributes</a>,
the element attributes and some <page href="funs">default callbacks</page>. This environment
is in fact a set of rewrite rules.</li>
<li>The rewrite rules applied on the template to get the final XML document;</li>
<li>The XML document is written to the final file.</li>
</ol>

<p>The environment is used in the following way.
For each encountered tag <icode>t</icode>, <icode>t</icode> is looked up
in the environment for its associated <em>function</em> <icode>f</icode>.
</p>
<p>If no <icode>f</icode> is found, then the XML tag is left untouched
and the children of the tag are then analysed.
</p>
<p>If <icode>f</icode> is found, then it is called, given the environment,
the tag attributes and the children of the tag. Then the function returns
a list of XML trees which must then be analysed.
</p>
<p>When this analyze reaches a fixpoint, the final XML is returned.
</p>
<p>This work is performed by the <ext-a href="https://github.com/zoggy/xtmpl">Xtmpl</ext-a>
library.</p>
<p>Besides, the contents of the attributes are also analysed to perform such substitutions,
before looking up for the tag in the environment.
</p>
<p>Stog comes with <page href="funs">predefined functions</page>
associated to some tags, but more can be created in plugins.
</p>
</section>
</prepare-toc>
</page>