page-title=Documentation
<->
<page id="funs"/>
<div class="alert alert-warning">
We assume Stog was correctly installed (see <page href="install"/>)
and the <icode>stog</icode> executable is in your <icode>PATH</icode>.
</div>

<section title="General considerations">
All text is assumed to be UTF-8 (source code, configuration files, ...).
</section>

<section title="Topics">
<ul class="toc">
<li><page href="funs"/></li>
</ul>
</section>

<div class="alert alert-error">
Everything below must be reorganized.
</div>

<prepare-toc depth="2">
<toc/>

<section name="setup" title="Set up a new project">
<p>
Setting up a new project is just a matter of creating directories and files.
</p>
<p>
A stog directory has the following structure:
</p>
<ul>
<li><icode>index.html</icode>: This is the main file of the web site,
containing information like site name, base url, contact email...,
This file is described <a href="mainfile">here</a>.</li>

<li><icode>tmpl/</icode>: This is the template directory. This is where
<icode>stog</icode> will lookup for template files by default; another
directory can be indicated with the <icode>--tmpl</icode> command line option.</li>

<li><icode>xxx.html</icode>: any <icode>.html</icode> file in the directory
will be considered as a static page of the site. See <a href="#staticpages">here</a>.
</li>

<li><icode>yyy/index.html</icode>: any subdirectory containing a <icode>index.html</icode>
file is considered as an article (= a blog post). Articles are described
<a href="#articles">here</a>.
</li>
</ul>
<p>
That's all ! You can add any other file if you need it, like a <icode>Makefile</icode>.
</p>
<p>If you're impatient and want to start from another site, you can start
from the <ext-a href="https://github.com/zoggy/stog/tree/master/doc"><icode>doc</icode> directory
in the Stog sources</ext-a>. It contains the
sources of the Stog web site (the one you're just reading).
</p>
</section>

<section name="principles" title="Principles">
<subsection name="principles:files" title="The files">
<p>
The principles are quite simple: You create your main <icode>index.html</icode>
file, one <icode>.html</icode> file for each page and one directory with an
<icode>index.html</icode> for each blog post.
</p>
<p>
All these files have the same format: a header of key-value pairs, a separator
and a body in XML. The syntax is given for <a href="#mainfile">the main file</a> and
it is the same in other <icode>.html</icode> files.
</p>
<p>The header contains some information used by Stog to make its work, like
knowing the title of articles, pages, ...
</p>
</subsection>
<subsection name="principles:xtmpl" title="Computing page contents">
<p>
When it comes to generate the <icode>.html</icode> for each of your
article or static page, the XML body is interpreted in the following way.
</p>
<p>
For each encountered tag <icode>t</icode>, <icode>t</icode> is looked up
in the environment for its associated <em>function</em> <icode>f</icode>.
</p>
<p>If no <icode>f</icode> is found, then the XML tag if left untouched
and the children of the tag are then analysed.
</p>
<p>If <icode>f</icode> is found, then it is called, given the environment,
the tag attributes and the children of the tag. Then the function returns
a list of XML trees which must then be analysed.
</p>
<p>When this analyze reaches a fixpoint, the final XML tree is written
to the <icode>.html</icode> file.
</p>
<p>This work is performed by the <ext-a href="https://github.com/zoggy/xtmpl">Xtmpl</ext-a>
library.</p>
<p>Besides, the contents of the attributes are also analysed to perform such substitutions,
before looking up for the tag in the environment.
</p>
<p>Stog comes with predefined functions associated to some tags, but more can
be created in plugins.</p>
<p>Some of these functions are common to all pages, while some are created
depending on the kind of page. For example, for articles, the original environment
contains a function associated to "article-date", to that putting
<hcode lang="xml"><![CDATA[<article-date/>]]></hcode> in the XML body will result in having
the article date inserted at this position.
</p>
</subsection>
<subsection name="principles:funs" title="Available functions"/>
<p>
The list of available functions is not yet documented, but
all are created in the <icode>Stog_html</icode> module.
Here are some.
</p>
<p>A special tag, "env_" can be used to modify the environment
before analysing children. For example, here we add an association
between "login" and "zoggy". This will add to the environment
an association between the key "login" and
the function returning the one-element list ["zoggy"], which is user
later in the "login" attribute:
<hcode lang="xml"><![CDATA[<env_ login="zoggy">...<user login="&lt;login/&gt;">...</user></env_>]]></hcode>
</p>
<p>
Another construction is used to include templates:
<hcode lang="xml"><![CDATA[<include file="foo.tmpl"/>]]></hcode>
will search for the file "foo.tmpl" in the template directory. This file must be valid
XML. To include a "raw" file, you can add the <icode>raw</icode> attribute. This can
be useful to include code. You can also put additional attributes, which will
be used as in the <icode>&lt;env_ ...&gt;</icode> node to extend the environment used to
analyse the included tree.
</p>
</section>

<section name="running" title="Running stog">
<p>
To compile your web site, use the following command:
<command-line><![CDATA[stog <your-directory>]]></command-line>
</p>
<p>Stog will generate your web site in <icode>./stog-output</icode>,
except if you use the <icode>-d</icode> option to specify another
output directory.
</p>
<p>You can specify a template directory with the <icode>--tmpl</icode>
option. By default, the <icode>tmpl</icode> directory is
<icode>your-directory/tmpl</icode>.
</p>
<p>
It is possible to give more than one directory to <icode>stog</icode>. In this case,
all pages and articles are merged as if all were defined in the last directory
given. It may be useful to gather blogs or page to generate one big site. Or not.
</p>
<p>The <icode>--base-url</icode> option is used to override the <icode>url</icode>
field of the main file. It it useful to generate a local site, for example
<command-line>stog --base-url file:///tmp/website your-directory</command-line>
to test your site locally with correct links.
</p>
<p>The <icode>--plugin</icode> option make <icode>stog</icode> dynamically
load the given OCaml object file. The loaded plugin can define new functions
to associate to some tags, or even override some pre-defined functions.
</p>
<p>At last, the <icode>--lang</icode> option is used to generate the website
for one language. By default, the only known languages are "en" and "fr".
If you use then <icode>--lang en</icode> option, then pages will be generated
in <icode>.en.html</icode> files and all "fr" nodes will be removed.
Then you can run <icode>stog</icode> with the <icode>--lang fr</icode>
to generate the "fr" part of your web site.
</p>
<p>
If you need more languages, just define "languages" in the main file header
this way:
<hcode>languages: es,de,fr,en</hcode>
</p>
</section>

<section name="mainfile" title="Main file: index.html">
<p>
The main <icode>index.html</icode> file has the following syntax:
</p>
<hcode lang="xml"><![CDATA[
title: your blog title (called "site-title")
description: your blog/site description (in one line) (called "site-description")
email: foo@bar.org (contact email)
url: http://the.base.url/where/your/site/will/be/ (called "site-url")
rss-length: 10 (optional: the number of items in generated rss channels)
<->
<div>Some xml code as starting point when generating your site
(and called "site-body").</div>]]>
</hcode>
</section>

<section title="To be continued">
<br/><br/><br/>
</section>

</prepare-toc>