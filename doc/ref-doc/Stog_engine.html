<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<ocamldoc with-contents="true">
<title>Stog library reference documentation : Stog_engine</title><contents><div class="ocamldoc-page">
<div class="navbar"><a class="pre" href="Stog_html5.html" title="Stog_html5">Previous</a>
&#160;<a class="up" href="index.html" title="Index">Up</a>
&#160;<a class="post" href="Stog_ocaml.html" title="Stog_ocaml">Next</a>
</div>
<h1>Module <a href="type_Stog_engine.html">Stog_engine</a></h1>

<pre><span class="keyword">module</span> Stog_engine: <code class="code">sig</code> <a href="Stog_engine.html">..</a> <code class="code">end</code></pre><div class="info module top">
Rewrite engine.<br/>
</div>
<hr width="100%"/>

<pre><code><span id="TYPElevel_fun"><span class="keyword">type</span> <code class="type">'a</code> level_fun</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTlevel_fun.Fun_stog"><span class="constructor">Fun_stog</span></span> <span class="keyword">of</span> <code class="type">(<a href="Stog_types.html#TYPEstog">Stog_types.stog</a> Xtmpl.env -&gt;<br/>      <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> -&gt; <a href="Stog_types.html#TYPEdoc_id">Stog_types.doc_id</a> list -&gt; <a href="Stog_types.html#TYPEstog">Stog_types.stog</a>)</code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTlevel_fun.Fun_data"><span class="constructor">Fun_data</span></span> <span class="keyword">of</span> <code class="type">('a Xtmpl.env -&gt;<br/>      <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a -&gt; <a href="Stog_types.html#TYPEdoc_id">Stog_types.doc_id</a> list -&gt; <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a)</code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTlevel_fun.Fun_stog_data"><span class="constructor">Fun_stog_data</span></span> <span class="keyword">of</span> <code class="type">((<a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a) Xtmpl.env -&gt;<br/>      <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a -&gt; <a href="Stog_types.html#TYPEdoc_id">Stog_types.doc_id</a> list -&gt; <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a)</code></code></td>

</tr></table>

<div class="info ">
A function associated to a level. All functions take in parameter
  the environment, the stog and structure and the list of documents
  to rewrite. They return the new stog structure. Some
  function (<code class="code">Fun_data</code>, <code class="code">Fun_stog_data</code>) also handle an additional data
  structure: the callbacks in the environment also handle it, and the
  function returns it with the stog structure.<br/>
</div>


<pre><code><span id="TYPEmodul"><span class="keyword">type</span> <code class="type">'a</code> modul</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&#160;&#160;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTmodul.mod_data">mod_data</span>&#160;: <code class="type">'a</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&#160;&#160;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTmodul.mod_levels">mod_levels</span>&#160;: <code class="type">'a <a href="Stog_engine.html#TYPElevel_fun">level_fun</a> Stog_types.Int_map.t</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&#160;&#160;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTmodul.mod_name">mod_name</span>&#160;: <code class="type">string</code>;</code></td>

</tr></table>
}

<div class="info ">
A structure containing data and functions associated to levels.
  Contains also the module name.<br/>
</div>


<pre><span class="keyword">module type</span> <a href="Stog_engine.Module.html">Module</a> = <code class="code">sig</code> <a href="Stog_engine.Module.html">..</a> <code class="code">end</code></pre><div class="info">
A module.
</div>

<pre><code><span id="TYPEstog_state"><span class="keyword">type</span> stog_state</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&#160;&#160;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstog_state.st_stog">st_stog</span>&#160;: <code class="type"><a href="Stog_types.html#TYPEstog">Stog_types.stog</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&#160;&#160;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTstog_state.st_modules">st_modules</span>&#160;: <code class="type">(module Stog_engine.Module) list</code>;</code></td>

</tr></table>
}



<pre><span id="VALrun"><span class="keyword">val</span> run</span> : <code class="type">?use_cache:bool -&gt;<br/>       ?docs:<a href="Stog_types.html#TYPEdoc_id">Stog_types.doc_id</a> list -&gt;<br/>       <a href="Stog_engine.html#TYPEstog_state">stog_state</a> -&gt; <a href="Stog_engine.html#TYPEstog_state">stog_state</a></code></pre>
<pre><span id="VALgenerate"><span class="keyword">val</span> generate</span> : <code class="type">?use_cache:bool -&gt;<br/>       ?only_docs:string list -&gt;<br/>       <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> -&gt; (module Stog_engine.Module) list -&gt; unit</code></pre><div class="info ">
Generate the target files, with the following steps:<ul>
<li>create the output directory,</li>
<li>build the base environment from the site global attributes,</li>
<li>compute by-topic, by-keyword and by-month documents,</li>
<li>compute documents,</li>
<li>for each level, for each document, apply level functions on the document</li>
<li>output <a href="Stog_types.html#TYPEELTdoc.doc_out"><code class="code">Stog_types.doc.doc_out</code></a> field in the destination file.</li>
</ul>
<br/>
</div>

<pre><span id="VALdoc_dst"><span class="keyword">val</span> doc_dst</span> : <code class="type">(string -&gt; string -&gt; string) -&gt;<br/>       ?encode:bool -&gt; <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> -&gt; string -&gt; <a href="Stog_types.html#TYPEdoc">Stog_types.doc</a> -&gt; string</code></pre>
<pre><span id="VALdoc_dst_file"><span class="keyword">val</span> doc_dst_file</span> : <code class="type"><a href="Stog_types.html#TYPEstog">Stog_types.stog</a> -&gt; <a href="Stog_types.html#TYPEdoc">Stog_types.doc</a> -&gt; string</code></pre><div class="info ">
Build the final file where the given document will be generated.<br/>
</div>

<pre><span id="VALdoc_url"><span class="keyword">val</span> doc_url</span> : <code class="type"><a href="Stog_types.html#TYPEstog">Stog_types.stog</a> -&gt; <a href="Stog_types.html#TYPEdoc">Stog_types.doc</a> -&gt; Neturl.url</code></pre><div class="info ">
Build the final url of the given document.<br/>
</div>

<pre><span id="VALenv_of_defs"><span class="keyword">val</span> env_of_defs</span> : <code class="type">?env:'a Xtmpl.env -&gt; <a href="Stog_types.html#TYPEdef">Stog_types.def</a> list -&gt; 'a Xtmpl.env</code></pre>
<pre><span id="VALenv_of_used_mods"><span class="keyword">val</span> env_of_used_mods</span> : <code class="type"><a href="Stog_types.html#TYPEstog">Stog_types.stog</a> -&gt; ?env:'a Xtmpl.env -&gt; Stog_types.Str_set.t -&gt; 'a Xtmpl.env</code></pre>
<pre><span id="TYPEstog_doc_rules"><span class="keyword">type</span> <code class="type">'a</code> stog_doc_rules</span> = <code class="type"><a href="Stog_types.html#TYPEstog">Stog_types.stog</a> -&gt; <a href="Stog_types.html#TYPEdoc_id">Stog_types.doc_id</a> -&gt; (Xtmpl.name * 'a Xtmpl.callback) list</code> </pre>


<pre><span id="VALget_in_env"><span class="keyword">val</span> get_in_env</span> : <code class="type">'a -&gt; 'a Xtmpl.env -&gt; Xmlm.name -&gt; 'a * Xtmpl.tree list</code></pre>
<pre><span id="VALopt_in_env"><span class="keyword">val</span> opt_in_env</span> : <code class="type">'a -&gt; 'a Xtmpl.env -&gt; Xmlm.name -&gt; 'a * Xtmpl.tree list option</code></pre>
<pre><span id="VALget_in_args_or_env"><span class="keyword">val</span> get_in_args_or_env</span> : <code class="type">'a -&gt; 'a Xtmpl.env -&gt; Xtmpl.attributes -&gt; Xmlm.name -&gt; 'a * Xtmpl.tree list</code></pre><div class="info ">
<code class="code">get_in_args_or_env env args s</code> returns the value associated to <code class="code">s</code>
 in <code class="code">args</code> of else return the result of <code class="code">get_in_env env s</code>.<br/>
</div>

<pre><span id="VALget_path"><span class="keyword">val</span> get_path</span> : <code class="type">'a -&gt; 'a Xtmpl.env -&gt; 'a * <a href="Stog_types.html#TYPEpath">Stog_types.path</a></code></pre><div class="info ">
<code class="code">get_path env</code> returns the path associated to <code class="code">"path"</code> in <code class="code">env</code>.<br/>
<b>Raises</b> <code>Assert_failure</code> if <code class="code">"path"</code> is not found in the environment.<br/>
</div>

<pre><span id="VALdoc_env"><span class="keyword">val</span> doc_env</span> : <code class="type">'a -&gt; 'a Xtmpl.env -&gt; <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> -&gt; <a href="Stog_types.html#TYPEdoc">Stog_types.doc</a> -&gt; 'a * 'a Xtmpl.env</code></pre>
<pre><span id="VALapply_stog_env_doc"><span class="keyword">val</span> apply_stog_env_doc</span> : <code class="type"><a href="Stog_types.html#TYPEstog">Stog_types.stog</a> -&gt;<br/>       <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> Xtmpl.env -&gt; <a href="Stog_types.html#TYPEdoc_id">Stog_types.doc_id</a> -&gt; <a href="Stog_types.html#TYPEstog">Stog_types.stog</a></code></pre>
<pre><span id="VALapply_stog_data_env_doc"><span class="keyword">val</span> apply_stog_data_env_doc</span> : <code class="type"><a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a -&gt;<br/>       (<a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a) Xtmpl.env -&gt; <a href="Stog_types.html#TYPEdoc_id">Stog_types.doc_id</a> -&gt; <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a</code></pre>
<pre><span id="VALapply_data_env_doc"><span class="keyword">val</span> apply_data_env_doc</span> : <code class="type"><a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a -&gt;<br/>       'a Xtmpl.env -&gt; <a href="Stog_types.html#TYPEdoc_id">Stog_types.doc_id</a> -&gt; <a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a</code></pre>
<pre><span id="VALfun_apply_stog_doc_rules"><span class="keyword">val</span> fun_apply_stog_doc_rules</span> : <code class="type"><a href="Stog_types.html#TYPEstog">Stog_types.stog</a> <a href="Stog_engine.html#TYPEstog_doc_rules">stog_doc_rules</a> -&gt; 'a <a href="Stog_engine.html#TYPElevel_fun">level_fun</a></code></pre>
<pre><span id="VALfun_apply_stog_data_doc_rules"><span class="keyword">val</span> fun_apply_stog_data_doc_rules</span> : <code class="type">(<a href="Stog_types.html#TYPEstog">Stog_types.stog</a> * 'a) <a href="Stog_engine.html#TYPEstog_doc_rules">stog_doc_rules</a> -&gt; 'a <a href="Stog_engine.html#TYPElevel_fun">level_fun</a></code></pre>
<pre><span id="VALfun_apply_data_doc_rules"><span class="keyword">val</span> fun_apply_data_doc_rules</span> : <code class="type">'a <a href="Stog_engine.html#TYPEstog_doc_rules">stog_doc_rules</a> -&gt; 'a <a href="Stog_engine.html#TYPElevel_fun">level_fun</a></code></pre>
<pre><span id="VALget_languages"><span class="keyword">val</span> get_languages</span> : <code class="type">'a -&gt; 'a Xtmpl.env -&gt; 'a * string list</code></pre><br/>
<div class="section-title" id="2_Registeringmodules">Registering modules</div><br/>

<pre><span id="TYPEmodule_fun"><span class="keyword">type</span> module_fun</span> = <code class="type"><a href="Stog_types.html#TYPEstog">Stog_types.stog</a> -&gt; (module Stog_engine.Module)</code> </pre>


<pre><span id="VALmodules"><span class="keyword">val</span> modules</span> : <code class="type">unit -&gt; (string * <a href="Stog_engine.html#TYPEmodule_fun">module_fun</a>) list</code></pre>
<pre><span id="VALregister_module"><span class="keyword">val</span> register_module</span> : <code class="type">string -&gt; <a href="Stog_engine.html#TYPEmodule_fun">module_fun</a> -&gt; unit</code></pre>
<pre><span id="VALmodule_by_name"><span class="keyword">val</span> module_by_name</span> : <code class="type">string -&gt; <a href="Stog_engine.html#TYPEmodule_fun">module_fun</a> option</code></pre></div></contents></ocamldoc>