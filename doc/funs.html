<page title="Predefined modules and functions"
navbar-doc="active"
with-contents="true"
>
<contents>
<section id="default_scheme" title="Default scheme">
<p>
As explained in <elt href="engine"/>, modules provide named functions associated
to levels, and the elements are succesively modified by these functions.
Additionaly, a function of a module can be associated to various levels.
</p>
<p>
The following modules are available by default:
<elt href="module_base">Base</elt>, <elt href="module_blocks">Blocks</elt>.
</p>
<p>Here is the list of default levels and their associated functions
defined by these modules:
</p>
<table class="table table-bordered table-condensed">
<tr><th>Level</th><th>Function(s)</th></tr>
<tr><td>  0</td><td><elt href="module_base#base"/> (Base)</td></tr>
<tr><td> 30</td><td><elt href="module_base#add-elts"/> (Base)</td></tr>
<tr><td> 50</td><td><elt href="module_base#toc"/> (Base)</td></tr>
<tr><td> 60</td><td><elt href="module_base#cut"/> (Base)</td></tr>
<tr><td> 61</td><td><elt href="module_base#base"/> (Base), <elt href="module_blocks#base"/> (Blocks)</td></tr>
<tr><td>100</td><td><elt href="module_blocks#sectionning"/> (Blocks)</td></tr>
<tr><td>120</td><td><elt href="module_blocks#gather-ids"/> (Blocks)</td></tr>
<tr><td>150</td><td><elt href="module_blocks#elt"/> (Blocks)</td></tr>
<tr><td>160</td><td><elt href="module_base#inc"/> (Base)</td></tr>
<tr><td>500</td><td><elt href="module_base#clean"/> (Base)</td></tr>
</table>
<p>For most of the rules applied by module functions, you should look
at the generated XML to modify
your CSS stylesheet according to the classes used. You can start from
the <icode>.less</icode> files in the <icode>doc</icode> directory
of the stog sources.
</p>
</section>

<section id="config_funs" title="Configuring the scheme">
<p>
The default scheme can be changed, using the <code>levels</code>
option in the <code>.stog/config</code> file.
This option contains a list of pairs of the following form:
</p>
<ocaml>("module-name",
  [ ("fun1", [ l1 ; l2 ; ...]) ;
    ("fun2", [ l3 ; l4 ; ...]) ;
    ... ;
  ])</ocaml>
<p>
The list is used to set the levels a function is associated to in a
given module. The default scheme could be expressed with:
</p>
<ocaml>levels = [
  ("html",
    [ ("base", [ 0 ; 61 ]) ;
      ("add-elts", [ 30 ]) ;
      ("toc", [ 50 ]) ;
      ("cut", [ 60 ]) ;
      ("inc", [ 160 ]) ;
      ("clean", [ 500 ]) ;
    ]) ;
  ("blocks",
    [ ("base", [ 61 ]) ;
      ("sectionning", [ 100 ]) ;
      ("gather-ids", [ 120 ]) ;
      ("elt", [ 150 ]) ;
    ]) ;
 ]
</ocaml>
<p>It is possible to change only the levels of some functions.
In the example below, the <elt href="module_base#inc"/> function
of module <elt href="module_base">Base</elt> will not be called,
(as it is associated to an empty list of levels)
and the <elt href="module_base#base"/> function of the same module
will be associated to levels 2 and 230, while the rest of the scheme
remains unchanged:
</p>
<ocaml>
levels = [
  ("html",
    [ ("base", [ 2 ; 230 ]) ;
      ("inc", [ ]) ;
    ]) ;
 ]
</ocaml>
<p>
Each module can associate only one function to a given level:
for a level and a module, the last associated function hides the
previous function associated to this level, if any.
</p>
</section>


<section id="base" title="Common base rules">
<p>
Some predefined rules are applied in various functions of the
predefined modules. They are listed here.
</p>

<subsection id="contents" title="contents">
<p>
<icode lang="xml">&lt;contents/&gt;</icode> is the generic function to insert some
contents in an included file or template. It may be available or not depending
on the context.
</p>
</subsection>

<subsection id="env_" title="env_">
<p>The special tag <icode>env_</icode> can be used to modify the environment
before analysing children. For example, here we add an association
between "login" and "zoggy". This will add to the environment
an association between the key "login" and
the function returning the one-element list ["zoggy"], which is used
later in the "login" attribute:
</p>
<hcode lang="xml"><![CDATA[<env_ login="zoggy">
  ...
  <user login="&lt;login/&gt;">...</user>
  ...
</env_>]]></hcode>
<p>Such a function cannot be created in plugins, since functions only return
XML trees, not a new environment. But your functions can return XML trees
containing <icode>env_</icode> tags to modify the environment used to
evaluate the returned XML trees.
</p>
</subsection>

<subsection id="langswitch" title="langswitch">
<p>
If <icode>stog</icode> is launched with option <icode>--lang language</icode>, the
<icode lang="xml">&lt;langswitch&gt;</icode> function returns some code to access
to pages in other languages than <icode>language</icode>.
</p>
</subsection>

</section>
<!--

<section id="level50" title="Level 50: Computing tables of contents">

</section>

<section id="level100" title="Level 100: Sectionning">
<include file="syntax.tmpl"><![CDATA[<section id="..." title="...">...</section>
<subsection id="..." title="...">...</subsection>
 ]]></include>
<p>This is used to insert sections and subsections, with a given title. The id,
if given, will be associated to the section title node.
</p>
<p>"section" and "subsection" are the default sectionning nodes.
You can specify other nodes:
</p>
<ul>
<li>for one element, using the "sectionning" attribute in the element, for example:
  <hcode lang="xml"><page title="..." sectionning="section,subsection,paragraph">...</page></hcode>
  will define "section", "subsection" and "paragraph" as sectionning nodes.
</li>
<li>for all the site elements, using the "stog:sectionning" attribute in the main element
  (see <elt href="stog-main-element"/>):
  <hcode lang="xml"><page title="..." stog:sectionning="section,subsection,paragraph">...</page></hcode>
</li>
</ul>
<p>
When a sectionning node is reduced, a <elt href="#block"/> is created, so that
refering to the section (or subsection, or ...), will use the title of the section
(or subsection, or ...) for the produced link default text.
</p>
<p>To prevent a sectionning node having a counter associated, you can use
<icode lang="xml">section-counter="false"</icode> in the element attribute, or
<icode lang="xml">stog:section-counter="false"</icode> in the main element. "section" can be replaced
by "subsection" or any other node to prevent this node having a counter.
</p>
</section>

<section id="level120" title="Level 120: Gathering existing ids">
<p>This level does not contain any additional rule. The only function
pre-defined in this level gathers all ids of all element, so that
cross-links in next levels can be verified.
</p>
<p>This function will issue a warning when an id is defined twice in the same element.</p>
</section>

<section id="level150" title="Level 150: Cross linking">
<also-base-rules/>
<p>
The default rules defined in this level are the following:
<icode>elt</icode>, <icode>post</icode>, <icode>page</icode> and <icode>block</icode>.
</p>
<include file="syntax.tmpl"><![CDATA[<elt href=hid[#id]>text</elt>]]></include>
<p>
This will return a link to the element specified by its hid. The hid of an element
is its absolute name from the root directoty of your project. You are not forced
to give the full path, but can also give only one or more of the last parts
of the path, as long as it uniquely identifies an existing element.
</p>
<p>
For example, suppose you want to refer to the element defined in file
<icode>&lt;root dir&gt;/foo/bar/hello.html</icode>. The hid of this element
is "/foo/bar/hello". You can refer to it in various ways:
</p>
<ul>
<li>with its absolute hid, providing the heading '/': <icode>/foo/bar/hello</icode>,</li>
<li>with only the last part of its hid: <icode>hello</icode>,</li>
<li>with an ending subpart of its hid: <icode>bar/hello</icode>.</li>
</ul>
<p>In the last two cases, an error will be raised if more than one elements
match the incomplete hid. You can provide an additional attribute <icode>type</icode>
to prevent ambiguities, for example:
</p>
<hcode lang="xml"><![CDATA[<elt href="bar/hello" type="post"/>]]></hcode>
<p>
Refering to an unknown element will raise an error. If no hid is given,
<icode>&lt;elt-hid/&gt;</icode> is used instead, i.e. the string associated to
<icode>elt-hid</icode> in the environment, to retrieve the current element hid.
</p>
<p>
A node id can also be specified, like <icode>thisblock</icode> in
<icode>href="blabla#thisblock"</icode>. Refering to an unknown block id
will raise an error.
</p>
<p>
If no text is given for the link, the title of the element
will be used instead (or, if a node id is given, the title associated to
the node id, if any). Specifying in attributes <icode>quotes="true"</icode>
indicates to add quotes around the element title.
</p>
<p>
<icode lang="xml">&lt;page ...&gt;</icode> and <icode lang="xml">&lt;post ... &gt;</icode>
are equivalent respectively to
<icode lang="xml">&lt;elt type="page" ...&gt;</icode> and
<icode lang="xml">&lt;elt type="post" ...&gt;</icode>.
</p>
<p>The <icode>block</icode> rule in this level hides the <elt href="#block"/> base rule.
In this level,
</p>
<hcode lang="xml"><block href="...">text</block></hcode>
<p>is used to refer to a block using the given <icode>href</icode> attribute. Here the
href only contains an id, it is not of the form "hid[#id]". This will
be reduced to a link to the corresponding element, using the given text.
</p>
<p>If the node matching the <icode>href</icode> was defined with the
<elt href="#block"/> base rule (i.e. without <icode>href</icode> attribute),
then the title associated to this node is used as text for the procuded link, if no
text was given (<icode lang="xml"><block href="..."/></icode>).
</p>
<p>So,</p>
<hcode lang="xml"><block href="fig1"/></hcode>
<p>is equivalent to</p>
<hcode lang="xml"><elt href="#fig1"/></hcode>
<p>or</p>
<hcode lang="xml"><elt id="&lt;elt-hid/&gt;#fig1"/></hcode>
<p>
But the purpose of <icode>block</icode> rule is not to be used directly, but rather
by defining other rules reducing to <icode>block</icode>, like environments in
latex for figures, proofs, propositions, ...
</p>
<p>Here is an example of definition of a function in an element definition:</p>
<hcode lang="xml">
<article title="..." with-contents="true">
<theorem id="" title="" href=""><block
  counter-name="theorem" class="theorem"
  label="Theorem" href="&lt;href/&gt;"
  id="&lt;id/&gt;" title="&lt;title/&gt;"
>
<div class="&lt;class/&gt;" id="&lt;id/&gt;">
  <div class="title"><title/></div>
  <div class="contents"><contents/></div>
</div></block></theorem>
<contents>...</contents>
</article></hcode>
<p>This defines a new rule <icode>theorem</icode> used this way to define a new theorem:</p>
<hcode lang="xml"><theorem id="thmain" title="Main result">...</theorem></hcode>
<p>Elsewhere, this theorem can be referred to using</p>
<hcode lang="xml"><theorem href="thmain"/></hcode>
<p>which will be reduced to a link with "Theorem 1" as text, if this theorem was the
first defined in the article.
</p>
</section>

<section id="level160" title="Level 160: Including blocks">
<include file="syntax.tmpl"><![CDATA[<late-inc href="..."/>]]></include>
<p>
This rule is used to insert the XML node specified by the <icode>href</icode> attribute.
See <elt href="#level150"/> for details about how to specify an element. The id of the
node if mandatory for this command.
</p>
</section>
-->
</contents>
</page>