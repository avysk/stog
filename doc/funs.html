page-title=Predefined functions
<->
<p>
The following functions are pre-defined and can be used in your pages,
articles and templates:
</p>
<prepare-toc depth="2">
<toc/>

<p>For most of the functions, you should look at the generated XML to modify
your CSS stylesheet according to the classes used. You can start from
the <icode>.less</icode> files in the <icode>doc</icode> directory
of the stog sources.
</p>

<section name="common" title="Common functions">
<subsection name="archive-tree" title="archive-tree">
<icode lang="xml">&lt;archive-tree/&gt;</icode> inserts the articles archive tree.
</subsection>

<subsection name="article" title="article">
<include file="syntax.tmpl"><![CDATA[<article href="...">text</article>]]></include>
<p>
This will return a link to the article specified by its id. The id of an article
is the base name of its directory in your project. Refering to an unknown
article will raise an error.
</p>
<p>
If no text is given for the link, the title of the article will be used instead.
</p>
</subsection>

<subsection name="articles" title="articles">
<icode lang="xml">&lt;articles max="..."/&gt;</icode> inserts the list of
published articles.
The optional <icode>max="n"</icode> attribute can be used to list only
the <icode>n</icode> last articles.
</subsection>

<subsection name="comand-line" title="command-line">
<icode lang="xml">&lt;command-line&gt;</icode> works like
<a href="#hcode"><icode lang="xml">&lt;hcode&gt;</icode></a>
with the <icode>lang</icode>
attribute already set to "sh".
</subsection>

<subsection name="ext-a" title="ext-a">
<icode lang="xml">&lt;ext-a attributes&gt;...&lt;/ext-a&gt;</icode> is reduced
to <icode lang="xml">&lt;span class="ext-a"&gt;&lt;a attributes&gt;...&lt;/&gt;&lt;/ext-a&gt;</icode>.
This can be used to add specific style link to external sites.
</subsection>

<subsection name="hcode" title="hcode">
<include file="syntax.tmpl"><![CDATA[<hcode lang="...">your code</hcode>]]></include>
<p>
This function inserts the given pre-formatted code. It uses the
<ext-a href="http://www.andre-simon.de/doku/highlight/en/highlight.html"><icode>highlight</icode></ext-a>
tool to add syntax highlighting. For example, the code examples of this page are
inserted using <hcode lang="xml"><![CDATA[<hcode lang="xml">...</hcode>]]></hcode>
</p>
</subsection>

<subsection name="icode" title="icode">
<icode lang="xml">&lt;icode&gt;</icode> works like
<a href="#hcode"><icode lang="xml">&lt;hcode&gt;</icode></a> but is used to
generate inline highlighted code instead of using a box.
</subsection>

<subsection name="if" title="if">
<include file="syntax.tmpl"><![CDATA[
<if attr1="value1" attr2="value2" ...>
<XML tree used when all conditions are verified>
<optional XML tree used when at least one condition is not verified>
</if>
]]></include>
<p>
The <icode>if</icode> function tests whether each condition expressed as <icode>attr="value"</icode>
is verified. If so, the first XML child is returned, else the second one is returned.
To test the value of <icode>attr</icode>, <icode>attr</icode> is looked up in the current
environment. It its value is the same as the given value, the condition is verified.
</p>
<p>
The <icode>"value"</icode> part of the condition must be valid XML, and can contain
calls to functions, as in:
<hcode lang="xml"><![CDATA[<if page-title="&lt;site-title&gt;">....</if>]]></hcode>
</p>
<p>Other example: Testing whether a variable is empty to known whether to output
a block or not:
<hcode lang="xml"><![CDATA[<if list="">
<span/>
<div>The list is not empty, let's print it:<ul><list/></ul></div>
</if>]]></hcode>
</p>
</subsection>

<subsection name="include" title="include">
<include file="syntax.tmpl"><![CDATA[<include file="template">...</include>]]></include>
<p>
This function will load the file <icode>template</icode> from the template directory
(or fail if the file does not exist). The contents of the file will then be evaluated.
The code between <icode>&lt;include ...&gt;</icode> and <icode>&lt;/include&gt;</icode>
is added to the environment used to evaluate the contents of the file, associated to
the name <icode>contents</icode>.
</p>
<p>
With the additional attribute <icode>raw="true"</icode>, the contents of the loaded file
is considered as PCData. This is useful for example to load code.
</p>
<p>At last, all additional attributes to <icode>&lt;include ...&gt;</icode> will
be added to the environment used to evaluate the contents of the file.
</p>
<p>Here is an example. If we have the <icode>foo.tmpl</icode> file
in the template directory, with the following contents:
<hcode lang="xml"><![CDATA[<p> key=<key/> value=<contents/> </p> ]]></hcode>
The following code
<hcode lang="xml"><![CDATA[<include file="foo.tmpl" key="bar">the value of bar</include>]]></hcode>
will be reduced to
<hcode lang="xml"><![CDATA[<p> key=bar value=the value of bar </p>]]></hcode>
</p>
</subsection>

<subsection name="image" title="image">
<include file="syntax.tmpl"><![CDATA[<image float="[left|right]" src="..." ...>legend</image>]]></include>
<p>
This generates an image using an <icode>&lt;img .../&gt;</icode> node. The legend is optional.
</p>
<p>
The <icode>float</icode> attribute can be used to change a class in the generated code,
so you can set the style of the image to be left or right floating.
</p>
<p>
Additional attributes are passed to the generated <icode>img</icode> node.
</p>
</subsection>

<subsection name="ocaml" title="ocaml">
<icode lang="xml">&lt;ocaml&gt;</icode> works like
<a href="#hcode"><icode lang="xml">&lt;hcode&gt;</icode></a>
with the <icode>lang</icode>
attribute already set to "ocaml".
</subsection>

<subsection name="rssfeedx" title="rssfeed">
<icode lang="xml">&lt;rssfeed/&gt;</icode> is available in pages an RSS feed is associated to,
like keywords page, ... It returns the url of the RSS feed.
</subsection>

<subsection name="section" title="section and subsection">
<include file="syntax.tmpl"><![CDATA[<section name="..." title="...">...</section>
<subsection name="..." title="...">...</subsection>
 ]]></include>
This is used to insert sections and subsections, with a given title. The name,
if given, is used as id in the section title node.
</subsection>

<subsection name="site-descx" title="site-desc">
<icode lang="xml">&lt;site-desc&gt;</icode> returns the site description as specified in the
main file.
</subsection>

<subsection name="site-titlex" title="site-title">
<icode lang="xml">&lt;site-title&gt;</icode> returns the site title as specified in the
main file.
</subsection>

<subsection name="site-url" title="site-url">
<icode lang="xml">&lt;site-url&gt;</icode> returns the site url as specified in the
main file.
</subsection>

<subsection name="toc" title="toc and prepare-toc">
<include file="syntax.tmpl"><![CDATA[<prepare-toc depth="[1|2|...]">
...
<toc>text</toc>
...
<section ...>
  <subsection ...>

  </subsection>
  ...
</section>
...
</prepare-toc>]]></include>
<p>
The <icode lang="xml">&lt;toc&gt;</icode> node is used to insert a table of contents.
If a text is given, it is added ahead of the table of contents.
</p>
<p>
Since the <icode>toc</icode> node does not include the sections and subsections, it is
not sufficient to build the table of contents. So it will use what is returned by
the function associated to "toc-contents" in its environment.
</p>
<p>This function is added to the environment by the <icode>prepare-toc</icode> node,
which includes all the sections and subsections. The <icode>depth</icode> attribute
is used to specify the depth of the table of contents.
</p>
</subsection>

<subsection name="two-columns" title="two-columns">
<include file="syntax.tmpl"><![CDATA[<two-columns>
<XML for left column/>
<XML for right column/>
</two-columns>]]></include>
<p>
This will put the two given XML nodes in a two-column layout.
</p>
</subsection>
</section>

<section name="in-articles" title="Functions available in &quot;article.tmpl&quot; template">
<subsection name="article-url" title="article-url">
<icode lang="xml">&lt;article-url&gt;</icode> returns the final url of the current article.
</subsection>

<subsection name="article-bodyx" title="article-body">
<icode lang="xml">&lt;article-body&gt;</icode> returns the body of the current article.
</subsection>
</section>


</prepare-toc>