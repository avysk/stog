<!DOCTYPE HTML>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Stog : Stog-rdf</title>
<link href="http://zoggy.github.io/stog/style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="page">
<div class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">


  <div class="nav-collapse">
    <ul class="nav">
    <li class="&lt;navbar-home/&gt;"><a href="http://zoggy.github.io/stog/index.html">Stog</a></li>
    <li class="&lt;navbar-install/&gt;"><a href="http://zoggy.github.io/stog/install.html">Installation</a></li>
    <li class="&lt;navbar-doc/&gt;"><a href="http://zoggy.github.io/stog/doc.html">Documentation</a></li>
    <li class="active"><a href="http://zoggy.github.io/stog/plugins.html">Plugins</a></li>
    <li class="&lt;navbar-blog/&gt;"><a href="http://zoggy.github.io/stog/blog.html">Blog</a></li>
    <li class="&lt;navbar-about/&gt;"><a href="http://zoggy.github.io/stog/about.html">?</a></li>
  </ul>
  <div class="nav pull-right">  </div>
  </div>

</div>
</div>
</div>

<div id="header">
  
  <a href="http://zoggy.github.io/stog/plugins.html">Plugins</a>
  
  <div class="page-title">Stog-rdf</div>
</div>





<div class="left-toc"><ul class="toc"><li class="toc-section"><a href="http://zoggy.github.io/stog/plugins/rdf.html#download">Download</a></li><li class="toc-section"><a href="http://zoggy.github.io/stog/plugins/rdf.html#install">Installation and usage</a></li><li class="toc-section"><a href="http://zoggy.github.io/stog/plugins/rdf.html#definetriples">Defining RDF triples</a></li><li class="toc-section"><a href="http://zoggy.github.io/stog/plugins/rdf.html#namespaces">Namespaces</a></li><li class="toc-section"><a href="http://zoggy.github.io/stog/plugins/rdf.html#sources">Using external graphs</a></li><li class="toc-section"><a href="http://zoggy.github.io/stog/plugins/rdf.html#querying">Querying graphs</a></li><li class="toc-section"><a href="http://zoggy.github.io/stog/plugins/rdf.html#tips">Tips</a></li></ul></div>
<p>
This plugin allows to easily specify RDF triples within documents,
to produce a RDF graph for the whole generated site. It also permits
executing Sparql queries to include data in the generated pages.
</p>
<p>
The following figure summarizes the way it works:
</p>
<img src="rdf_fig.svg" width="300"/>
<p>
Additional rewrite levels are defined:
</p>
<ul>
<li>level 200: contain rules to <a href="http://zoggy.github.io/stog/plugins/rdf.html#definetriples">define triples</a>
     in the graph of each stog document,</li>
<li>level 201: gather all graphs into one graph and output it in the destination directory,</li>
<li>level 202: contain rules to <a href="http://zoggy.github.io/stog/plugins/rdf.html#sources">load external graphs</a>,</li>
<li>level 220: contain rules to <a href="http://zoggy.github.io/stog/plugins/rdf.html#querying">query the graphs</a>,
  either graphs built during document rewriting or external graphs.</li>
</ul>
<div class="section"><div class="section-title" id="download">Download</div>
<div class="alert alert-info">
Stog-rdf is available in <span class="ext-a"><a href="http://opam.ocaml.org/">Opam</a></span>.
With opam installed, just type the following command to install stog-rdf:
<pre class="code-sh">opam <span class="hl kwc">install</span> stog<span class="hl opt">-</span>rdf</pre>
</div>

<p>
Stog-rdf is <span class="ext-a"><a href="https://github.com/zoggy/stog-rdf">hosted on Github</a></span>.
You can clone the git repository:
</p>
<pre class="code-sh">git clone git@github.com<span class="hl opt">:</span>zoggy<span class="hl opt">/</span>stog<span class="hl opt">-</span>rdf.git</pre>
<div class="subsection"><div class="subsection-title" id="releases">Releases</div>
<ul>
<li><a href="stog-rdf-0.10.0.tar.gz">0.10.0</a> [2014/01/21]:
  <ul id="changes0.10.0">
    <li>Upgrade to new Stog 0.10.0 architecture,</li>
    <li>Base rules are not applied, they must be
     explictely run after level 220 to apply on result
    of <span class="icode"><span class="hl kwa">&lt;rdf-select</span><span class="hl kwa">&gt;</span></span> (using the
    <a href="http://zoggy.github.io/stog/funs.html#config_funs">&quot;levels&quot; field in
    stog config file</a>),
    </li>
    <li>Bug fixes.</li>
  </ul>
</li>
<li><a href="stog-rdf-0.9.0.tar.gz">0.9.0</a> [2013/09/27]:
  <ul id="changes0.9.0">
    <li>Upgrade to OCaml-RDF 0.7.0,</li>
    <li>Upgrade to Stog 0.9.0,</li>
    <li>New <span class="icode"><span class="hl kwa">&lt;rdf-select</span><span class="hl kwa">&gt;</span></span> rule to
      <a href="http://zoggy.github.io/stog/plugins/rdf.html#querying">query graphs</a> using Sparql,</li>
    <li>New <span class="icode"><span class="hl kwa">&lt;rdf-load</span><span class="hl kwa">&gt;</span></span> rule to
      <a href="http://zoggy.github.io/stog/plugins/rdf.html#rdfload">load external graphs</a>,</li>
    <li>Ability to define external graphs to <a href="http://zoggy.github.io/stog/plugins/rdf.html#startupgraphs">load at startup</a>,</li>
    <li>Bug fixes.</li>
  </ul>
</li>
<li><a href="stog-rdf-0.8.0.tar.gz">0.8.0</a> [2013/03/20]: Upgrade to Stog 0.8.0.</li>
<li><a href="stog-rdf-0.7.0.tar.gz">0.7.0</a> [2013/02/13]: Minor fixes.</li>
<li><a href="stog-rdf-0.6.tar.gz">0.6</a>: First numbered release.</li>
</ul>
</div>
</div>

<div class="section"><div class="section-title" id="install">Installation and usage</div>
<div class="subsection"><div class="subsection-title" id="77f3-5ee1-28f0-8967">Compiling and installing</div>
<pre class="code-sh"><span class="hl kwb">cd</span> stog<span class="hl opt">-</span>rdf<span class="hl opt">-</span>XXX
<span class="hl kwc">make</span> all <span class="hl kwc">install</span></pre>
<p>
(you must have <span class="ext-a"><a href="http://zoggy.github.io/ocaml-rdf/">OCaml-RDF</a></span> &gt;= 0.8.0 installed).
This will install the <span class="icode"><span class="hl std">stog-rdf</span></span> package with ocamlfind.
</p>
</div>
<div class="subsection"><div class="subsection-title" id="ba88-af39-88f0-933f">Usage</div>
<p>
To use:
</p>
<pre class="code-sh">stog <span class="hl opt">--</span>package stog<span class="hl opt">-</span>rdf ...</pre>
<p>You can also build a custom stog executable, linked with the plugin:
</p>
<pre class="code-sh">mk<span class="hl opt">-</span>stog <span class="hl opt">--</span>package stog<span class="hl opt">-</span>rdf <span class="hl opt">-</span>o mystog ...</pre>
<p>
If you want to use mysql or postresql backends, do not forget to also link
the required packages, for example for mysql:
</p>
<pre class="code-sh">mk<span class="hl opt">-</span>stog <span class="hl opt">--</span>package stog<span class="hl opt">-</span>rdf<span class="hl opt">,</span>rdf.mysql <span class="hl opt">-</span>o mystog ...</pre>
</div>

</div>
<div class="section"><div class="section-title" id="definetriples">Defining RDF triples</div>
<p>
Stog-rdf defines a new rewrite rule <span class="icode"><span class="hl std">rdf</span></span> associated to level 200.
Each <span class="icode"><span class="hl kwa">&lt;rdf</span><span class="hl kwa">&gt;</span></span> node corresponds to a new triple whose subject
is the current document url, or the current block id of the current
document if the <span class="icode"><span class="hl kwa">&lt;rdf</span><span class="hl kwa">&gt;</span></span> node is contained in a XML node with an
<span class="icode"><span class="hl std">id</span></span> attribute. This triple is added to the graph associated to
the current document.
</p>
<p>
Another function, associated to level 201, merges all RDF
graphs into one graph and dumps this graph into a file.
The name of this file is set in the <span class="icode"><span class="hl std">.stog/config-rdf</span></span> file
(default is <span class="icode"><span class="hl std">graph.rdf</span></span>).
</p>
<div class="subsection"><div class="subsection-title" id="tripleexamples">Examples</div>
<pre class="code-xml"><span class="hl kwa">&lt;page</span><span class="hl std"> </span><span class="">title</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl kwa">&gt;</span><span class="hl std">
  ...
  </span><span class="hl kwa">&lt;rdf</span><span class="hl std"> </span><span class="">pred</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std"> </span><span class="">obj</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl kwa">/&gt;</span><span class="hl std">
  ...
</span><span class="hl kwa">&lt;/page</span><span class="hl kwa">&gt;</span><span class="hl std">
</span></pre>
<p>
Subject is the document url, <span class="icode"><span class="hl std">pred</span></span> is the IRI of the predicate
(possibly of the form <span class="icode"><span class="hl std">prefix:term</span></span>). <span class="icode"><span class="hl std">obj</span></span> is the IRI of
the object.
</p>
<pre class="code-xml"><span class="hl kwa">&lt;page</span><span class="hl std"> </span><span class="">title</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl kwa">&gt;</span><span class="hl std">
  ...
  </span><span class="hl kwa">&lt;rdf</span><span class="hl std"> </span><span class="">pred</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std"> </span><span class="">href</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl kwa">/&gt;</span><span class="hl std">
  ...
</span><span class="hl kwa">&lt;/page</span><span class="hl kwa">&gt;</span><span class="hl std">
</span></pre>
<p>
Subject and predicate are as in the first example. <span class="icode"><span class="hl std">href</span></span> is of
the form <span class="icode"><span class="hl std">path[#id]</span></span> to indicate an document of the site, and eventually
a node id in this document. This is reduced to the complete IRI
of the document or block referenced by <span class="icode"><span class="hl std">document#id</span></span>.
</p>
<pre class="code-xml"><span class="hl kwa">&lt;page</span><span class="hl std"> </span><span class="">title</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl kwa">&gt;</span><span class="hl std">
   ...
   </span><span class="hl kwa">&lt;p</span><span class="hl std"> </span><span class="">id</span><span class="hl std">=</span><span class="hl str">&quot;id1&quot;</span><span class="hl kwa">&gt;</span><span class="hl std">
     </span><span class="hl kwa">&lt;rdf</span><span class="hl std"> </span><span class="">pred</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std"> ...</span><span class="hl kwa">/&gt;</span><span class="hl std">
   </span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;/page</span><span class="hl kwa">&gt;</span><span class="hl std">
</span></pre>
<p>
Here the subject is the IRI formed by the document url and the id of the
<span class="icode"><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span></span> node, for example <span class="icode"><span class="hl std">http://my.example.com/foo/page1.html#id1</span></span>
if my document has path <span class="icode"><span class="hl std">foo/page1</span></span> and base url of the site is
<span class="icode"><span class="hl std">http://my.example.com</span></span>.
</p>
<p>
To add the triples, the
<span class="icode"><span class="hl kwa">&lt;rdf</span><span class="hl std"> </span><span class="">pred</span><span class="hl std">=</span><span class="hl str">&quot;pref:term&quot;</span><span class="hl std"> ...</span><span class="hl kwa">&gt;</span><span class="hl std">...</span><span class="hl kwa">&lt;/rdf</span><span class="hl kwa">&gt;</span></span> node is rewritten to
</p>
<pre class="code-xml"><span class="hl kwa">&lt;rdf:Description</span><span class="hl std"> </span><span class="">rdf:about</span><span class="hl std">=</span><span class="hl str">&quot;&lt;document-url&gt;[#id]&quot;</span><span class="hl kwa">&gt;</span><span class="hl std">
  </span><span class="hl kwa">&lt;pref:term</span><span class="hl std"> ...</span><span class="hl kwa">&gt;</span><span class="hl std">
    ...
  </span><span class="hl kwa">&lt;/pref:term</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;/rdf:Description</span><span class="hl kwa">&gt;</span><span class="hl std">
</span></pre>
<p>
and this XML tree is parsed using OCaml-RDF
<span class="ext-a"><a href="http://www.w3.org/TR/rdf-syntax-grammar/">RDF/XML</a></span> parser to add the triples
to the document graph. If a <span class="icode"><span class="hl std">href</span></span> or <span class="icode"><span class="hl std">obj</span></span> attribute was used,
the corresponding IRI is associated to the `rdf:resource` attribute in the rewritten node:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;rdf:Description</span><span class="hl std"> </span><span class="">rdf:about</span><span class="hl std">=</span><span class="hl str">&quot;&lt;document-url&gt;[#id]&quot;</span><span class="hl kwa">&gt;</span><span class="hl std">
  </span><span class="hl kwa">&lt;pref:term</span><span class="hl std"> </span><span class="">rdf:resource</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std"> ...</span><span class="hl kwa">&gt;</span><span class="hl std">
    ...
  </span><span class="hl kwa">&lt;/pref:term</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;/rdf:Description</span><span class="hl kwa">&gt;</span><span class="hl std">
</span></pre>
<p>
and the whole <span class="icode"><span class="hl kwa">&lt;rdf:Description</span><span class="hl kwa">&gt;</span></span> node is parsed by the RDF/XML parser.
</p>
<p>
It is possible to insert triple with a subject not being the current document
or a block of the current document, using the <span class="icode"><span class="hl std">subject</span></span> attribute:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;rdf</span><span class="hl std"> </span><span class="">subject</span><span class="hl std">=</span><span class="hl str">&quot;http://foo.bar&quot;</span><span class="hl std"> </span><span class="">pred</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std"> ...</span><span class="hl kwa">/&gt;</span></pre>
<p>
It is sometimes useful to force the subject to be the current document url even if the
<span class="icode"><span class="hl kwa">&lt;rdf</span><span class="hl kwa">&gt;</span></span> node is under a XML node with an id:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;p</span><span class="hl std"> </span><span class="">id</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl kwa">&gt;</span><span class="hl std">
  </span><span class="hl kwa">&lt;rdf</span><span class="hl std"> </span><span class="">subject</span><span class="hl std">=</span><span class="hl str">&quot;&amp;lt;doc-url/&amp;gt;&quot;</span><span class="hl std"> </span><span class="">pred</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std"> ...</span><span class="hl kwa">/&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span></pre>
</div>
</div>
<div class="section"><div class="section-title" id="namespaces">Namespaces</div>
<p>
Namespaces used in RDF triples in the site must be declared in the
<span class="icode"><span class="hl std">.stog/config-rdf</span></span> file.
</p>
<p>
The <span class="icode"><span class="hl std">rdf</span></span> and <span class="icode"><span class="hl std">site</span></span> namespaces don't need to be
specified and are automatically handled respectively as
</p>
<pre class="code-xml"><span class="hl std">rdf:http://www.w3.org/1999/02/22-rdf-syntax-ns#
site:</span><span class="hl kwa">&lt;site</span><span class="hl std"> </span><span class="">base</span><span class="hl std"> </span><span class="">url</span><span class="hl kwa">&gt;</span><span class="hl std">
</span></pre>
<p>
(the site base url is the one specified with <span class="icode"><span class="hl std">stog:site-url</span></span> in the main stog document).
</p>
</div>

<div class="section"><div class="section-title" id="sources">Using external graphs</div>
<p>
External graphs can be loaded at startup time or with the
<span class="icode"><span class="hl kwa">&lt;rdf-load</span><span class="hl kwa">&gt;</span></span> rule.
</p>
<p>
Once loaded, these graphs can be used in Sparql queries, using
<span class="icode"><span class="hl std">FROM</span></span> or <span class="icode"><span class="hl std">FROM NAMED</span></span> clauses.
</p>
<div class="subsection"><div class="subsection-title" id="startupgraphs">Loading graphs at startup</div>
<p>
Graphs to load at startup are given in the <span class="icode"><span class="hl std">sources</span></span> parameter
of the <span class="icode"><span class="hl std">.stog/config-rdf</span></span> file. For each graph, we indicate
its name (an IRI), and options. Options describe where to load the graph
from.
</p>
<p>
Here is an example of configuration file describing two graphs to load,
one from a file, and one from a MySQL database:
</p>
<pre class="code-ocaml"><span class="hl com">(* pairs (uri, name) specifying namespaces *)</span><span class="hl std">
</span><span class="">namespaces</span><span class="hl std"> =
  [(</span><span class="hl str">&quot;http://super-namespace.net/&quot;</span><span class="hl std">, </span><span class="hl str">&quot;super&quot;</span><span class="hl std">)]
</span><span class="hl com">(* name of main graph output file *)</span><span class="hl std">
</span><span class="">graph_file</span><span class="hl std"> = </span><span class="hl str">&quot;graph.rdf&quot;</span><span class="hl std">
</span><span class="hl com">(* pairs (uri, options) specifying graphs to load and associate to uris.
   Options is a list of pair (name, value). To load a load, use [&quot;file&quot;,
   &quot;myfile.ttl&quot;]. Other options can be given to access graphs from a database
   (see OCaml-RDF's Rdf_graph documentation) *)</span><span class="hl std">
</span><span class="">sources</span><span class="hl std"> =
  [
   (</span><span class="hl str">&quot;http://foo.net/&quot;</span><span class="hl std">, [ (</span><span class="">file</span><span class="hl std">, </span><span class="hl str">&quot;foo_net.ttl&quot;</span><span class="hl std">) ]) ;
   (</span><span class="hl str">&quot;http://foo.bar.net/&quot;</span><span class="hl std">,
    [(</span><span class="">storage</span><span class="hl std">, </span><span class="">mysql2</span><span class="hl std">); (</span><span class="">database</span><span class="hl std">, </span><span class="">genet_example</span><span class="hl std">); (</span><span class="">user</span><span class="hl std">, </span><span class="">genet</span><span class="hl std">);
     (</span><span class="">host</span><span class="hl std">, </span><span class="">localhost</span><span class="hl std">); (</span><span class="">password</span><span class="hl std">, </span><span class="hl str">&quot;&quot;</span><span class="hl std">); (</span><span class="">port</span><span class="hl std">, </span><span class="hl str">&quot;3306&quot;</span><span class="hl std">)])
  ]
</span></pre>
<p>
The options associated to each IRI are the options passed to the
<span class="ext-a"><a href="http://zoggy.github.io/ocaml-rdf/refdoc/Rdf_graph.html#VALopen_graph">Rdf_graph.open_graph</a></span>
function in OCaml-RDF.
</p>
<p>By default, files are expected to be in Turtle format.
Setting the &quot;format&quot; option to &quot;rdf/xml&quot; indicates that the file is in RDF/XML format.
</p>
</div>

<div class="subsection"><div class="subsection-title" id="rdfload">Loading graphs with rdf-load</div>
<p>
A graph can be loaded when the XML node <span class="icode"><span class="hl kwa">&lt;rdf-load</span><span class="hl kwa">&gt;</span></span>
is encountered. This rule is registered in level 202.
</p>
<p>The general form of using this rule is:</p>
<pre class="code-xml"><span class="hl kwa">&lt;rdf-load</span><span class="hl std"> </span><span class="">att1</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std"> </span><span class="">att2</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl kwa">/&gt;</span></pre>
<p>Each attribute defines a pair (name, value) used as an option. The complete
option list is used as the option lists specified in the <span class="icode"><span class="hl std">.stog/config-rdf</span></span>
file (see <a href="http://zoggy.github.io/stog/plugins/rdf.html#startupgraphs">Loading graphs at startup</a>).
</p>
<p>The following code loads a graph named <span class="icode"><span class="hl std">http://foo.net/</span></span>
from a Turtle file <span class="icode"><span class="hl std">foo_net.ttl</span></span> in the same directory
as the source file of the current document:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;rdf-load</span><span class="hl std"> </span><span class="">file</span><span class="hl std">=</span><span class="hl str">&quot;./foo_net.ttl&quot;</span><span class="hl std"> </span><span class="">name</span><span class="hl std">=</span><span class="hl str">&quot;http://foo.net/&quot;</span><span class="hl kwa">/&gt;</span></pre>
<p>
If the filename is not explicitely relative to the current directory
(i.e. if it does not start with &quot;.&quot; or &quot;..&quot;) then is it used as is.
</p>
<p>
The following code loads a graph named <span class="icode"><span class="hl std">http://foo.bar.net/</span></span>
from a MySQL database, using the given options:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;rdf-load</span><span class="hl std"> </span><span class="">name</span><span class="hl std">=</span><span class="hl str">&quot;http://foo.bar.net/&quot;</span><span class="hl std"> </span><span class="">storage</span><span class="hl std">=</span><span class="hl str">&quot;mysql2&quot;</span><span class="hl std">
  </span><span class="">database</span><span class="hl std">=</span><span class="hl str">&quot;genet_example&quot;</span><span class="hl std"> </span><span class="">user</span><span class="hl std">=</span><span class="hl str">&quot;genet&quot;</span><span class="hl std"> </span><span class="">host</span><span class="hl std">=</span><span class="hl str">&quot;localhost&quot;</span><span class="hl std"> </span><span class="">password</span><span class="hl std">=</span><span class="hl str">&quot;&quot;</span><span class="hl std"> </span><span class="">port</span><span class="hl std">=</span><span class="hl str">&quot;3306&quot;</span><span class="hl kwa">/&gt;</span><span class="hl std">
</span></pre>
<p>
If no <span class="icode"><span class="hl std">file</span></span> attribute is given, and the <span class="icode"><span class="hl kwa">&lt;rdf-load</span><span class="hl kwa">&gt;</span></span>
node is not empty, then the PCDATA content of the node is used as Turtle code
describing the triples to load in the graph. For example:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;rdf-load</span><span class="hl std"> </span><span class="">name</span><span class="hl std">=</span><span class="hl str">&quot;http://foo.bar.org/&quot;</span><span class="hl kwa">&gt;</span><span class="hl std">&lt;![CDATA[
@prefix toto: </span><span class="hl kwa">&lt;http:</span><span class="hl std">//</span><span class="">toto</span><span class="hl std">.</span><span class="">net</span><span class="hl kwa">/&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;http:</span><span class="hl std">//</span><span class="">foo</span><span class="hl std">.</span><span class="">bar</span><span class="hl std">.</span><span class="">org</span><span class="hl std">/</span><span class="">toto</span><span class="hl kwa">&gt;</span><span class="hl std"> a toto:file .
]]&gt;</span><span class="hl kwa">&lt;/rdf-load</span><span class="hl kwa">&gt;</span></pre>

</div>
</div>

<div class="section"><div class="section-title" id="querying">Querying graphs</div>
<p>
The <span class="icode"><span class="hl kwa">&lt;rdf-select</span><span class="hl kwa">&gt;</span></span> rule, registered in level 220, allows to
execute <span class="ext-a"><a href="http://www.w3.org/TR/sparql11-query">Sparql 1.1</a></span> queries,
either on the graph built during rewriting of documents
(see <a href="http://zoggy.github.io/stog/plugins/rdf.html#definetriples">Defining RDF triples</a>) or on loaded graphs
(see <a href="http://zoggy.github.io/stog/plugins/rdf.html#sources">Using external graphs</a>).
</p>
<p>
The <span class="icode"><span class="hl kwa">&lt;rdf-select</span><span class="hl kwa">&gt;</span></span> rule takes the following parameters:
</p>
<ul>
<li>the query, which must be a SELECT query,</li>
<li>the template to apply for each solution of the query,</li>
<li>an optional separator, inserted between each application of the template,</li>
<li>optional additional arguments as pairs (name, value), which are added to the
environment when applying the template.</li>
</ul>
<p>
The parameters for the <span class="icode"><span class="hl kwa">&lt;rdf-select</span><span class="hl kwa">&gt;</span></span> rule are given in the following way:
</p>
<pre class="code-xml"><span class="hl std">  </span><span class="hl kwa">&lt;rdf-select</span><span class="hl std"> [</span><span class="">query</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std">] [</span><span class="">tmpl</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std">] [</span><span class="">sep</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std">]</span><span class="hl kwa">&gt;</span><span class="hl std">DATA</span><span class="hl kwa">&lt;/rdf-select</span><span class="hl kwa">&gt;</span><span class="hl std">
</span></pre>
<p>
If DATA does not contain XML nodes and DATA is not empty,
then DATA is used as query, even if the <span class="icode"><span class="hl std">query=&quot;...&quot;</span></span> attribute is given.
</p>
<p>
If DATA contains XML nodes, they are used to override the previous definition of the
query, the template and the separator. For example:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;rdf-select</span><span class="hl kwa">&gt;</span><span class="hl std">
  </span><span class="hl kwa">&lt;query</span><span class="hl kwa">&gt;</span><span class="hl std">SELECT ?url ?name WHERE { ... }</span><span class="hl kwa">&lt;/query</span><span class="hl kwa">&gt;</span><span class="hl std">
  </span><span class="hl kwa">&lt;tmpl</span><span class="hl kwa">&gt;</span><span class="hl kwa">&lt;li</span><span class="hl kwa">&gt;</span><span class="hl kwa">&lt;a</span><span class="hl std"> </span><span class="">href</span><span class="hl std">=</span><span class="hl str">&quot;&amp;lt;url/&amp;gt;&quot;</span><span class="hl kwa">&gt;</span><span class="hl kwa">&lt;name</span><span class="hl kwa">/&gt;</span><span class="hl kwa">&lt;/a</span><span class="hl kwa">&gt;</span><span class="hl kwa">&lt;/li</span><span class="hl kwa">&gt;</span><span class="hl kwa">&lt;/tmpl</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;/rdf-select</span><span class="hl kwa">&gt;</span><span class="hl std">
</span></pre>
<p>If the template is specified in the attribute <span class="icode"><span class="hl std">tmpl=&quot;s&quot;</span></span>, then <span class="icode"><span class="hl std">s</span></span>
is considered as being a template file. If the template is specified in a <span class="icode"><span class="hl kwa">&lt;tmpl</span><span class="hl kwa">&gt;</span></span>
node, then the template is the content of the node.
</p>
<p>The separator is always &quot;inline&quot;, whether it is given in the <span class="icode"><span class="hl std">sep=&quot;...&quot;</span></span>
attribute or in the <span class="icode"><span class="hl kwa">&lt;sep</span><span class="hl kwa">&gt;</span></span> node.
</p>
<p>If the query is specified in the attributes and in a <span class="icode"><span class="hl kwa">&lt;query</span><span class="hl kwa">&gt;</span></span> node,
only the content of the node is used.
</p>
<p>Additional attributes and additional nodes are used to enrich the environment used
when applying the template.
</p>
<p>The namespaces defined in <span class="icode"><span class="hl std">.stog/config-rdf</span></span> are used to
automatically define prefixes at the beginning of the query; they do not
have to be declared again in the query.
</p>
<p>For each solution of the query, the template is applied. The variables appearing
in the solution (the variables in the SELECT clause of the query) are added to
the environment before applying the template. In the example above, for each solution,
the variables <span class="icode"><span class="hl std">?url</span></span> and <span class="icode"><span class="hl std">?name</span></span> are associated,
in the environment used to evaluate the template, to the RDF terms they are mapped to
in the solution, and they can be referred to
using <span class="icode"><span class="hl kwa">&lt;url</span><span class="hl kwa">/&gt;</span></span> and <span class="icode"><span class="hl kwa">&lt;name</span><span class="hl kwa">/&gt;</span></span>.
</p>
<p>
Moreover, additional variables, postfixed with &quot;_rdf&quot;, are also added to the environment
so that the associated term can be inserted in a Sparql-compatible syntax,
for example to use result in another Sparql query in the template.
In the example above, results in Sparql syntax are accessible
using <span class="icode"><span class="hl kwa">&lt;url_rdf</span><span class="hl kwa">/&gt;</span></span> and <span class="icode"><span class="hl kwa">&lt;name_rdf</span><span class="hl kwa">/&gt;</span></span>.
</p>
</div>

<div class="section"><div class="section-title" id="tips">Tips</div>
<p>
To make definition of triples even easier, one can define rules in the
document header, for example:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;page</span><span class="hl std"> </span><span class="">title</span><span class="hl std">=</span><span class="hl str">&quot;...&quot;</span><span class="hl std"> </span><span class="">with-contents</span><span class="hl std">=</span><span class="hl str">&quot;true&quot;</span><span class="hl kwa">&gt;</span><span class="hl std">
  </span><span class="hl kwa">&lt;isproof</span><span class="hl kwa">&gt;</span><span class="hl kwa">&lt;rdf</span><span class="hl std"> </span><span class="">pred</span><span class="hl std">=</span><span class="hl str">&quot;rdf:hasType&quot;</span><span class="hl std"> </span><span class="">obj</span><span class="hl std">=</span><span class="hl str">&quot;science:proof&quot;</span><span class="hl kwa">/&gt;</span><span class="hl kwa">&lt;/isproof</span><span class="hl kwa">&gt;</span><span class="hl std">
  </span><span class="hl kwa">&lt;contents</span><span class="hl kwa">&gt;</span><span class="hl std">
    ...
      </span><span class="hl kwa">&lt;div</span><span class="hl std"> </span><span class="">class</span><span class="hl std">=</span><span class="hl str">&quot;proof&quot;</span><span class="hl std"> </span><span class="">id</span><span class="hl std">=</span><span class="hl str">&quot;proof1&quot;</span><span class="hl kwa">&gt;</span><span class="hl std">
        </span><span class="hl kwa">&lt;isproof</span><span class="hl kwa">/&gt;</span><span class="hl std">
      ...
      </span><span class="hl kwa">&lt;/div</span><span class="hl kwa">&gt;</span><span class="hl std">
    ...
  </span><span class="hl kwa">&lt;/contents</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;/page</span><span class="hl kwa">&gt;</span><span class="hl std">
</span></pre>
<p>
This will add a triple
</p>
<pre class="code-xml"><span class="hl kwa">&lt;document-url</span><span class="hl kwa">&gt;</span><span class="hl std">#proof1 rdf:hasType science:proof</span></pre>
</div>







<div id="footer">
<div class="generatedon">Generated on March 20, 2014 at 14h17</div>
</div>



</div> 
</body>
</html>
