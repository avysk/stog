<!DOCTYPE HTML>
<html>
<head>
<title>Stog : Developing plugins</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="stylesheet" type="text/css" href="http://zoggy.github.com/stog/style.css"/>
</head><body>
<div id="page">
<div class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">


  <ul class="nav">
    <li class="&lt;navbar-home/&gt;"><a href="http://zoggy.github.com/stog/index.html">Stog</a></li>
    <li class="&lt;navbar-install/&gt;"><a href="http://zoggy.github.com/stog/install.html">Installation</a></li>
    <li class="active"><a href="http://zoggy.github.com/stog/doc.html">Documentation</a></li>
    <li class="&lt;navbar-blog/&gt;"><a href="http://zoggy.github.com/stog/blog.html">Blog</a></li>
    <li class="&lt;navbar-about/&gt;"><a href="http://zoggy.github.com/stog/about.html">?</a></li>
  </ul>
  <div class="nav pull-right">

  </div>

</div>
</div>
</div>

<div id="header">

<div class="page-title">Developing plugins</div>
</div>
<span/>


<p>
Plugins are written in OCaml. The compiled OCaml code is then
loaded in Stog with the <span class="icode">--plugin</span> or <span class="icode">--package</span>
options of <span class="icode">stog</span> (see <a href="http://zoggy.github.com/stog/getting_started.html#running">&quot;Getting started&quot;</a>).
</p>
<div class="section"><div class="section-title" id="writing">Writing the code</div>
<p>
A plugin just registers new functions associated to tags.
Here is an example:
</p>
<pre class="code-ocaml"><span class="hl com">(** Stog plugin example. *)</span>

<span class="hl kwa">let</span> fun_list env args subs <span class="hl opt">=</span>
  <span class="hl com">(* get the optional sep attribute ... *)</span>
  <span class="hl kwa">let</span> sep <span class="hl opt">=</span> <span class="hl kwc">Xtmpl</span><span class="hl opt">.</span>opt_arg args <span class="hl opt">&amp;</span>quot<span class="hl opt">;</span>sep<span class="hl opt">&amp;</span>quot<span class="hl opt">;</span> <span class="hl kwa">in</span>
  <span class="hl com">(* and parse it as xml *)</span>
  <span class="hl kwa">let</span> xml <span class="hl opt">=</span> <span class="hl kwc">Xtmpl</span><span class="hl opt">.</span>xml_of_string sep <span class="hl kwa">in</span>
  <span class="hl com">(* We can access the stog structure with [Stog_plug.stog ()] .</span>
<span class="hl com">     We don't use it here.</span>
<span class="hl com">  *)</span>

  <span class="hl com">(* then insert the separator between all children of the node *)</span>
  <span class="hl kwa">let rec</span> iter acc <span class="hl opt">=</span> <span class="hl kwa">function</span>
    <span class="hl opt">[] -&amp;</span>gt<span class="hl opt">;</span> <span class="hl kwc">List</span><span class="hl opt">.</span>rev acc
  | h <span class="hl opt">::</span> q <span class="hl opt">-&amp;</span>gt<span class="hl opt">;</span>
      <span class="hl kwa">let</span> acc <span class="hl opt">=</span>
        <span class="hl kwa">match</span> acc <span class="hl kwa">with</span>
          <span class="hl opt">[] -&amp;</span>gt<span class="hl opt">; [</span>h<span class="hl opt">]</span>
        | _ <span class="hl opt">-&amp;</span>gt<span class="hl opt">;</span> h <span class="hl opt">::</span> xml <span class="hl opt">::</span> acc
      <span class="hl kwa">in</span>
      iter acc q
  <span class="hl kwa">in</span>
  <span class="hl com">(* and finally return the list of xml trees *)</span>
  iter <span class="hl opt">[]</span> subs
<span class="hl opt">;;</span>

<span class="hl com">(* register the new function, associated to tag &amp;quot;list&amp;quot; *)</span>
<span class="hl kwa">let</span> <span class="hl opt">() =</span> <span class="hl kwc">Stog_plug</span><span class="hl opt">.</span>register_fun <span class="hl opt">&amp;</span>quot<span class="hl opt">;</span>list<span class="hl opt">&amp;</span>quot<span class="hl opt">;</span> fun_list<span class="hl opt">;;</span>
</pre>
</div>

<div class="section"><div class="section-title" id="compiling">Compilation</div>
<p>
The plugin is simply compiled with
<pre class="code-sh">ocamlfind ocamlopt <span class="hl opt">-</span>package stog <span class="hl opt">-</span>rectypes <span class="hl opt">-</span>shared <span class="hl opt">-</span>o plugin_example.cmxs plugin_example.ml
</pre>
for native code or
<pre class="code-sh">ocamlfind ocamlc <span class="hl opt">-</span>package stog <span class="hl opt">-</span>rectypes <span class="hl opt">-</span>c plugin_example.ml
</pre>
for bytecode.
</p>
</div>

<div class="section"><div class="section-title" id="using">Using</div>
<p>
The plugin is used by specifying it one the <span class="icode">stog</span> command line:
</p>
<pre class="code-sh">stog <span class="hl opt">--</span>plugin plugin_example.cmxs ...
</pre>
<p>or, if the plugin is installed with ocamlfind:</p>
<pre class="code-sh">stog <span class="hl opt">--</span>package plugin_example ...
</pre>
<p>
With our plugin example, we can use the new &quot;list&quot;:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;list</span> <span class="hl kwb">sep</span>=<span class="hl str">&quot;&amp;lt;b&amp;gt; -- &amp;lt;/b&amp;gt;&quot;</span><span class="hl kwa">&gt;&lt;span&gt;</span>first thing<span class="hl kwa">&lt;/span&gt;</span>second thing<span class="hl kwa">&lt;div&gt;</span>something else<span class="hl kwa">&lt;/div&gt;&lt;/list&gt;</span>
</pre>
<p>
This will be evaluated (reduced) to
</p>
<pre class="code-xml"><span class="hl kwa">&lt;span&gt;</span>first thing<span class="hl kwa">&lt;/span&gt;&lt;b&gt;</span> -- <span class="hl kwa">&lt;/b&gt;</span>second thing<span class="hl kwa">&lt;b&gt;</span> -- <span class="hl kwa">&lt;/b&gt;&lt;div&gt;</span>something else<span class="hl kwa">&lt;/div&gt;</span>
</pre>

</div>



<div>
<p class="alert alert-info">
For information you can see the <a href="#pagesource"> source code of the page</a>.
</p>
<div id="pagesource">
<pre class="code-xml"><span class="hl kwd">&amp;lt;</span>page title=<span class="hl kwd">&amp;quot;</span>Developing plugins<span class="hl kwd">&amp;quot;</span>
navbar-doc=<span class="hl kwd">&amp;quot;</span>active<span class="hl kwd">&amp;quot;</span>
<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>p<span class="hl kwd">&amp;gt;</span>
Plugins are written in OCaml. The compiled OCaml code is then
loaded in Stog with the <span class="hl kwd">&amp;lt;</span>icode<span class="hl kwd">&amp;gt;</span>--plugin<span class="hl kwd">&amp;lt;</span>/icode<span class="hl kwd">&amp;gt;</span> or <span class="hl kwd">&amp;lt;</span>icode<span class="hl kwd">&amp;gt;</span>--package<span class="hl kwd">&amp;lt;</span>/icode<span class="hl kwd">&amp;gt;</span>
options of <span class="hl kwd">&amp;lt;</span>icode<span class="hl kwd">&amp;gt;</span>stog<span class="hl kwd">&amp;lt;</span>/icode<span class="hl kwd">&amp;gt;</span> (see <span class="hl kwd">&amp;lt;</span>page href=<span class="hl kwd">&amp;quot;</span>getting_started#running<span class="hl kwd">&amp;quot;</span>/<span class="hl kwd">&amp;gt;</span>).
<span class="hl kwd">&amp;lt;</span>/p<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>section name=<span class="hl kwd">&amp;quot;</span>writing<span class="hl kwd">&amp;quot;</span> title=<span class="hl kwd">&amp;quot;</span>Writing the code<span class="hl kwd">&amp;quot;&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>p<span class="hl kwd">&amp;gt;</span>
A plugin just registers new functions associated to tags.
Here is an example:
<span class="hl kwd">&amp;lt;</span>/p<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>hcode lang=<span class="hl kwd">&amp;quot;</span>ocaml<span class="hl kwd">&amp;quot;</span> defer_=<span class="hl kwd">&amp;quot;</span><span class="hl num">1</span><span class="hl kwd">&amp;quot;&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>include file=<span class="hl kwd">&amp;quot;</span>../../../plugins/plugin_example.ml<span class="hl kwd">&amp;quot;</span> raw=<span class="hl kwd">&amp;quot;</span>true<span class="hl kwd">&amp;quot;</span>/<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>/hcode<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>/section<span class="hl kwd">&amp;gt;</span>

<span class="hl kwd">&amp;lt;</span>section name=<span class="hl kwd">&amp;quot;</span>compiling<span class="hl kwd">&amp;quot;</span> title=<span class="hl kwd">&amp;quot;</span>Compilation<span class="hl kwd">&amp;quot;&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>p<span class="hl kwd">&amp;gt;</span>
The plugin is simply compiled with
<span class="hl kwd">&amp;lt;</span>command-line<span class="hl kwd">&amp;gt;</span>ocamlfind ocamlopt -package stog -rectypes -shared -o plugin_example.cmxs plugin_example.ml<span class="hl kwd">&amp;lt;</span>/command-line<span class="hl kwd">&amp;gt;</span>
for native code or
<span class="hl kwd">&amp;lt;</span>command-line<span class="hl kwd">&amp;gt;</span>ocamlfind ocamlc -package stog -rectypes -c plugin_example.ml<span class="hl kwd">&amp;lt;</span>/command-line<span class="hl kwd">&amp;gt;</span>
for bytecode.
<span class="hl kwd">&amp;lt;</span>/p<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>/section<span class="hl kwd">&amp;gt;</span>

<span class="hl kwd">&amp;lt;</span>section name=<span class="hl kwd">&amp;quot;</span>using<span class="hl kwd">&amp;quot;</span> title=<span class="hl kwd">&amp;quot;</span>Using<span class="hl kwd">&amp;quot;&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>p<span class="hl kwd">&amp;gt;</span>
The plugin is used by specifying it one the <span class="hl kwd">&amp;lt;</span>icode<span class="hl kwd">&amp;gt;</span>stog<span class="hl kwd">&amp;lt;</span>/icode<span class="hl kwd">&amp;gt;</span> command line:
<span class="hl kwd">&amp;lt;</span>/p<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>command-line<span class="hl kwd">&amp;gt;</span>stog --plugin plugin_example.cmxs ...<span class="hl kwd">&amp;lt;</span>/command-line<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>p<span class="hl kwd">&amp;gt;</span>or, if the plugin is installed with ocamlfind:<span class="hl kwd">&amp;lt;</span>/p<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>command-line<span class="hl kwd">&amp;gt;</span>stog --package plugin_example ...<span class="hl kwd">&amp;lt;</span>/command-line<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>p<span class="hl kwd">&amp;gt;</span>
With our plugin example, we can use the new <span class="hl kwd">&amp;quot;</span>list<span class="hl kwd">&amp;quot;</span>:
<span class="hl kwd">&amp;lt;</span>/p<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>hcode lang=<span class="hl kwd">&amp;quot;</span>xml<span class="hl kwd">&amp;quot;&amp;gt;&amp;lt;</span>![CDATA[
<span class="hl kwd">&amp;lt;</span>list sep=<span class="hl kwd">&amp;quot;&amp;amp;</span>lt;b<span class="hl kwd">&amp;amp;</span>gt; -- <span class="hl kwd">&amp;amp;</span>lt;/b<span class="hl kwd">&amp;amp;</span>gt;<span class="hl kwd">&amp;quot;&amp;gt;&amp;lt;</span>span<span class="hl kwd">&amp;gt;</span>first thing<span class="hl kwd">&amp;lt;</span>/span<span class="hl kwd">&amp;gt;</span>second thing<span class="hl kwd">&amp;lt;</span>div<span class="hl kwd">&amp;gt;</span>something else<span class="hl kwd">&amp;lt;</span>/div<span class="hl kwd">&amp;gt;&amp;lt;</span>/list<span class="hl kwd">&amp;gt;</span>]]<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>/hcode<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>p<span class="hl kwd">&amp;gt;</span>
This will be evaluated (reduced) to
<span class="hl kwd">&amp;lt;</span>/p<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>hcode defer_=<span class="hl kwd">&amp;quot;</span><span class="hl num">1</span><span class="hl kwd">&amp;quot;</span> lang=<span class="hl kwd">&amp;quot;</span>xml<span class="hl kwd">&amp;quot;&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>list sep=<span class="hl kwd">&amp;quot;&amp;amp;</span>lt;b<span class="hl kwd">&amp;amp;</span>gt; -- <span class="hl kwd">&amp;amp;</span>lt;/b<span class="hl kwd">&amp;amp;</span>gt;<span class="hl kwd">&amp;quot;&amp;gt;&amp;lt;</span>span<span class="hl kwd">&amp;gt;</span>first thing<span class="hl kwd">&amp;lt;</span>/span<span class="hl kwd">&amp;gt;</span>second thing<span class="hl kwd">&amp;lt;</span>div<span class="hl kwd">&amp;gt;</span>something else<span class="hl kwd">&amp;lt;</span>/div<span class="hl kwd">&amp;gt;&amp;lt;</span>/list<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>/hcode<span class="hl kwd">&amp;gt;</span>

<span class="hl kwd">&amp;lt;</span>/section<span class="hl kwd">&amp;gt;</span>
<span class="hl kwd">&amp;lt;</span>/page<span class="hl kwd">&amp;gt;</span>
</pre>
</div>
</div>
</div>

<footer id="bottombar">
</footer>
</body>
</html>