<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Stog : Getting started</title>
<link rel="stylesheet" type="text/css" href="http://zoggy.github.com/stog/style.css"/>
</head>
<body>
<div id="page">
<div class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">


  <ul class="nav">
    <li class="&lt;navbar-home/&gt;"><a href="http://zoggy.github.com/stog/index.html">Stog</a></li>
    <li class="&lt;navbar-install/&gt;"><a href="http://zoggy.github.com/stog/install.html">Installation</a></li>
    <li class="active"><a href="http://zoggy.github.com/stog/doc.html">Documentation</a></li>
    <li class="&lt;navbar-plugins/&gt;"><a href="http://zoggy.github.com/stog/stog-plugins.html">Plugins</a></li>
    <li class="&lt;navbar-blog/&gt;"><a href="http://zoggy.github.com/stog/blog.html">Blog</a></li>
    <li class="&lt;navbar-about/&gt;"><a href="http://zoggy.github.com/stog/about.html">?</a></li>
  </ul>
  <div class="nav pull-right">

  </div>

</div>
</div>
</div>

<div id="header">
  
  <div class="page-title">Getting started</div>
</div>





Sections:<ul class="toc"><li class="toc-section"><a href="#principle">Principle</a></li><li class="toc-section"><a href="#elements">Stog elements</a></li><li class="toc-section"><a href="#mainelement">Stog main element</a></li><li class="toc-section"><a href="#running">Running Stog</a></li><li class="toc-section"><a href="#templates">Evaluation and templating</a></li><li class="toc-section"><a href="#functions">Attributes and functions</a></li></ul>

<div class="section"><div class="section-title" id="principle">Principle</div>
<p>
When launched on a given root directory, <span class="icode">stog</span> will read all files
and directories
from this starting point and generate the same hierarchy in the output directory.
</p>
<p>
Some of the files will be read as <i>elements</i>, i.e. xml files which will
be processed through a templating engine to produce the final file.
</p>
<p>
The <span class="icode">.stog</span> directory in the given root directory contains the
templates (in directory <span class="icode">templates</span>) and the
<span class="icode">config</span> file, containing stog configuration. In this file,
using regular expressions, one can indicate which files must be ignored,
and which files are elements. Files not being ignored nor being elements
will be copied by <span class="icode">stog</span> in the target directory.
</p>
<p>
Here is an example of <span class="icode">.stog/config</span> file:
</p>
<pre class="code-ocaml"><span class="hl com">(* Regexps of files to ignore *)</span>
ignored <span class="hl opt">= [</span><span class="hl str">&quot;.*</span><span class="hl esc">\\</span><span class="hl str">.git&quot;</span><span class="hl opt">;</span> <span class="hl str">&quot;.*Makefile&quot;</span><span class="hl opt">;</span> <span class="hl str">&quot;.*tmpl$&quot;</span><span class="hl opt">;</span> <span class="hl str">&quot;.*less$&quot;</span><span class="hl opt">;</span> <span class="hl str">&quot;.*</span><span class="hl esc">\\</span><span class="hl str">.chamo.*&quot;</span><span class="hl opt">]</span>
<span class="hl com">(* Regexps of files containing elements *)</span>
elements <span class="hl opt">= [</span><span class="hl str">&quot;.*</span><span class="hl esc">\\</span><span class="hl str">..xml$&quot;</span><span class="hl opt">;</span> <span class="hl str">&quot;.*</span><span class="hl esc">\\</span><span class="hl str">.html$&quot;</span><span class="hl opt">]</span>
<span class="hl com">(* Regexps of files matching 'elements' regexps but not containing elements</span>
<span class="hl com">   *)</span>
<span class="hl str">&quot;not-elements&quot;</span> <span class="hl opt">= []</span></pre>
<p>
A default file is generated by <span class="icode">stog</span> if it does not exist.
</p>
<p>
When launched, <span class="icode">stog</span> performs the following actions:
</p>
<ol>
<li>Read the given directory hierarachy;</li>
<li>Create the output directory;</li>
<li>Generate element files in this directory;</li>
<li>Copy all other files in the target directory, of course
  keeping the source directory structure.</li>
</ol>
</div>

<div class="section"><div class="section-title" id="elements">Stog elements</div>
<p>
An element is an Xml tree, defined in a file matched by the regular expressions
given in the configuration file. It has one of the following forms. First form:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;type</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Element title&quot;</span>
 <span class="hl kwb">attribute</span>=<span class="hl str">&quot;value&quot;</span>
 <span class="hl kwb">attribute2</span>=<span class="hl str">&quot;value2&quot;</span>
 ...
<span class="hl kwa">&gt;</span>
Here is the body of the element.
<span class="hl kwa">&lt;/type&gt;</span></pre>
<p>Second form, almost the same, except that <span class="icode">with-contents=&quot;true&quot;</span>
indicates that more attributes are given in subnodes, and the body is in the
<span class="icode">contents</span> subnode:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;type</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Element title&quot;</span>
 <span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span>
 <span class="hl kwb">attribute</span>=<span class="hl str">&quot;value&quot;</span>
 ...
<span class="hl kwa">&gt;</span>
 <span class="hl kwa">&lt;attribute2&gt;</span>value2<span class="hl kwa">&lt;/attribute2&gt;</span>
 ...
 <span class="hl kwa">&lt;contents&gt;</span>Here is the body of the element.<span class="hl kwa">&lt;/contents&gt;</span>
<span class="hl kwa">&lt;/type&gt;</span></pre>
<p>
<span class="icode">type</span> can be any string (like &quot;post&quot;, &quot;page&quot;, ...) and defines the type
of the element. This allows different treatements according to the element type.
</p>
<p>
You can specify any attribute for an element. Some attributes are used
internally:
</p>
<ul>
<li><b>title</b>: this is the title of the element; use <span class="icode">&lt;elt-title/&gt;</span>
in templates to access it,</li>
<li><b>keywords</b>: the list of comma-separated keywords associated to the element;
use <span class="icode">&lt;elt-keywords/&gt;</span> in templates to insert the list of keywords
with links to by-keyword index,</li>
<li><b>topics</b>: same as keywords, but for topics (access with <span class="icode">&lt;elt-topics/&gt;</span>),</li>
<li><b>date</b>: the element date, used for sorting in list. The date in specified in
the form <i>YYYY/MM/DD</i>. Use <span class="icode">&lt;elt-date/&gt;</span> in templates to insert it,</li>
<li><b>published</b>: can be set to <i>false</i> to prevent the element from being generated;
useful when an element is not ready yet for publication,</li>
<li><b>sets</b>: a comma-separated list of set names; sets can be used to list elements
belonging to a set,</li>
<li><b>language-dep</b>: can be set to <i>false</i> to indicate that this page is not
language dependent, when generating multi-language sites (this affects the name of the
generated file),</li>
<li><b>doctype</b>: specify the doctype which will be printed into the final XML file. Default is &quot;HTML&quot;.</li>
</ul>
<p>
Any other attribute will be available by its name in the environment when processing the template
associated to the element type. The element type can be accessed with <span class="icode">&lt;elt-type/&gt;</span>.
More details in <a href="http://zoggy.github.com/stog/getting_started.html#functions">Attributes and functions</a>.
</p>
<p>
To generate the file corresponding to an element, <span class="icode">stog</span> will use the type of
the element (for example &quot;post&quot;) to load the associated template (for example &quot;post.tmpl&quot; in
the templates directory).
</p>
<p>You can have a look at the source of the pages of this site at the bottom of each page.
The sources of this site can be a good starting point. You can browse it in the
<span class="ext-a"><a href="https://github.com/zoggy/stog/tree/master/doc">doc directory of the
distribution</a></span>.
</p>
</div>

<div class="section"><div class="section-title" id="mainelement">Stog main element</div>
<p>
One element is called the main element. This element is a regular
element with the <span class="icode">main</span> attribute set to &quot;true&quot;. There can be only
one main element.
</p>
<p>
Some attributes of this main element are used to specify site-wide information:
</p>
<ul>
<li><b>title</b>: The title of the blog is the same as this element and can be accessed
with &lt;site-title/&gt; in templates,</li>
<li><b>stog:site-description</b>: A short description of the site; use &lt;site-description/&gt;
to access it in templates;</li>
<li><b>stog:site-url</b>: The base url of the site, used to forge urls when generating pages;
use &lt;site-url/&gt; to insert it in templates,</li>
<li><b>stog:site-email</b>: A contact email for the site, accessible with &lt;site-email/&gt;,</li>
<li><b>stog:rss-length</b>: The default length of RSS feeds.</li>
</ul>
<p>
In the main element, any attribute beginning with &quot;stog:&quot; will be used as global attribute
and accessible in all templates by its name. Other attributes are associated to the element only.
</p>
</div>

<div class="section"><div class="section-title" id="running">Running Stog</div>
<p>
To compile your web site, use the following command:
<pre class="code-sh">stog <span class="hl opt">&lt;</span>root<span class="hl opt">-</span>directory<span class="hl opt">&gt;</span></pre>
</p>
<p>Stog will generate your web site in <span class="icode">./stog-output</span>,
except if you use the <span class="icode">-d</span> option to specify another
output directory.
</p>
<p>You can specify a template directory with the <span class="icode">--tmpl</span>
option. By default, the templates are searched in the <span class="icode">.stog/templates</span> directory
of the specified root directory.
</p>
<p>
It is possible to give more than one directory to <span class="icode">stog</span>. In this case,
all pages and articles are merged as if all were defined in the last directory
given. It may be useful to gather blogs or page to generate one big site. Or not.
</p>
<p>The <span class="icode">--site-url</span> option is used to override the <span class="icode">stog:site-url</span>
field of the main element. It it useful to generate a local site, for example
<pre class="code-sh">stog <span class="hl opt">--</span>site<span class="hl opt">-</span>url <span class="hl kwc">file</span><span class="hl opt">:///</span>tmp<span class="hl opt">/</span>website your<span class="hl opt">-</span>directory</pre>
to test your site locally with correct links.
</p>
<p>The <span class="icode">--plugin</span> option makes <span class="icode">stog</span> dynamically
load the given OCaml object file. The loaded plugin can define new functions
to associate to some tags, or even override some pre-defined functions.
See <a href="http://zoggy.github.com/stog/plugins.html">Developing plugins</a>.
</p>
<p>
If a plugin was installed with ocamlfind, the <span class="icode">--package</span> option can be used
to specify a list of comma-separated packages to load. <span class="icode">ocamlfind</span> will
then be used to get the location and required files to load these packages, in bytecode
for <span class="icode">stog.byte</span> or native-code for <span class="icode">stog</span>.
</p>
<p>At last, the <span class="icode">--lang</span> option is used to generate the website
for one language. By default, the only known languages are &quot;en&quot; and &quot;fr&quot;.
If you use the <span class="icode">--lang en</span> option, then pages will be generated
in <span class="icode">.en.html</span> files and all <span class="icode">&lt;fr&gt;</span> nodes will be removed.
Then you can run <span class="icode">stog</span> with the <span class="icode">--lang fr</span>
to generate the &quot;fr&quot; part of your web site, removing all <span class="icode">&lt;en&gt;</span>.
</p>

<p>
Stog will keep computed elements in directory <code>.stog/cache</code>.
To prevent stog from using this cache, use the <code>--nocache</code>
command line option. The cache won't be read, but it will nevertheless
be updated by contents of computed elements.
</p>
<p>
The caching strategy uses dependencies between elements: if an element
refers to another one (see <a href="http://zoggy.github.com/stog/funs.html">Predefined functions</a>), a dependency will be
added and stored in the cache directory, so that this dependency will
be used during the next run of stog. An element can also depend
on files: the templates used, the files included, ... Dependencies are
recursively computed.
</p>
<p>
In some cases, using recursive dependencies may be too complete. For example,
if you have a menubar appearing in all pages, all pages will depend on
the elements referenced by the menubar, leading to all elements depending
on all elements. A change in any element will then make every element recomputed
at each run. To prevent this, the <code>--depcut</code> option specifies
to use non-recursive dependencies in the caching strategy.
</p>
<p>
A convenient way to use stog is to create a Makefile with different targets,
to generate your site for a local test and for online publishing.
Have a look at <span class="ext-a"><a href="https://github.com/zoggy/stog/tree/master/doc/Makefile">this
Makefile</a></span> used to build stog documentation.
</p>
</div>

<div class="section"><div class="section-title" id="templates">Evaluation and templating</div>
<p>
The final files corresponding to elements are built the following way.
</p>
<p>Various rewrite levels are defined in Stog, and plugins can add more levels.
</p>
<p>A level is composed of a list of functions, each function taking an element
and returning the (eventually modified) element. Pre-defined levels are composed
of functions applying rewrite rules to element body.
</p>
<p>Various levels are required to ensure some rules will be applied after
others, for example to verify cross-element links. Each level has a number,
and levels are applied in order from 0 to n. Pre-defined levels are
numbered like lines in BASIC programs: 0, 50, 100, 120, ... making
plugins able to insert new levels.
</p>
<p>The first application of a level to an element uses the
type of the element to load the corresponding template; for example,
if the element has type &quot;page&quot;, then a template <span class="icode">page.tmpl</span> will
be looked for.
</p>
<p>An environment is built containing the
<a href="#mainelement">site-wide attributes</a> and the element attributes.
This environment is a set of rewrite rules.
</p>
<p>In each level, each function of the level is applied to the element current body
(the &quot;first current body&quot; is the template, where <span class="icode">&lt;elt-body/&gt;</span> will be
rewritten to the tree of the element body as given in the element file).
</p>
<p>The pre-defined levels contain pre-defined functions which apply
<a href="http://zoggy.github.com/stog/funs.html">default rules</a>, in addition to the rules from
the environment and rules added by plugins.
</p>
<p>When all levels were applied to elements, the contents of each element
is stored in the cache (the <span class="icode">.stog/cache</span> directory).
The final XML file is also created from this contents.
</p>
<p>Remark: If the element file was not modified since the corresponding
cache file was stored, nor its dependencies (see <a href="http://zoggy.github.com/stog/getting_started.html#running">Running Stog</a>),
the contents of the element is read back from
the cache, and the level functions are not applied to this element.
</p>

<p>The environment is used in the following way.
For each encountered node with tag <span class="icode">t</span>, <span class="icode">t</span> is looked up
in the environment for its associated <em>function</em> <span class="icode">f</span>.
</p>
<p>If no <span class="icode">f</span> is found, then the XML node is left untouched
and the children of the node are then analysed.
</p>
<p>If <span class="icode">f</span> is found, then it is called, given the environment,
the attributes and the children of the node. Then the function returns
a list of XML trees which must then be analysed.
</p>
<p>When this analyze reaches a fixpoint, the final XML is returned.
</p>
<p>This work is performed by the <span class="ext-a"><a href="https://github.com/zoggy/xtmpl">Xtmpl</a></span>
library.</p>
<p>Besides, the contents of the attributes are also analysed to perform such substitutions,
before looking up for the tag in the environment.
</p>
<p>Stog comes with <a href="http://zoggy.github.com/stog/funs.html">predefined functions</a>
associated to some tags, but more can be created in
<a href="http://zoggy.github.com/stog/plugins.html">plugins</a>.
</p>
</div>

<div class="section"><div class="section-title" id="functions">Attributes and functions</div>
<p>
When defining elements, you can add attributes, which will be added
to the base environment when applying level functions to this element.
For example:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;page</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;....&quot;</span>
...
<span class="hl kwb">author</span>=<span class="hl str">&quot;Santa Claus&quot;</span>
<span class="hl kwa">&gt;</span>
.... <span class="hl kwa">&lt;author/&gt;</span> ....
<span class="hl kwa">&lt;/page&gt;</span></pre>
<p>
Here the node <span class="icode"><span class="hl kwa">&lt;author/&gt;</span></span> will we rewritten to
&quot;Santa Claus&quot; (without quotes).
</p>
<p>The same can be achieved for more complex nodes, using the
<span class="icode"><span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span></span>
attribute:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;page</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;....&quot;</span>
  <span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span>
  ...
<span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;author&gt;&lt;b&gt;</span>Santa Claus<span class="hl kwa">&lt;/b&gt;&lt;/author&gt;</span>
<span class="hl kwa">&lt;contents&gt;</span>
.... <span class="hl kwa">&lt;author/&gt;</span> ....
<span class="hl kwa">&lt;/contents&gt;</span>
<span class="hl kwa">&lt;/page&gt;</span></pre>
<p>here <span class="icode"><span class="hl kwa">&lt;author/&gt;</span></span> will we rewritten to
<span class="icode"><span class="hl kwa">&lt;b&gt;</span>Santa Claus<span class="hl kwa">&lt;/b&gt;</span></span>.
</p>
<p>
You can also define functions. A function is defined like an attribute
when having <span class="icode"><span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span></span>, except the
node defining the name of the function has XML attributes:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;page</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;....&quot;</span>
  <span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span>
  ...
<span class="hl kwa">&gt;</span>
...
<span class="hl kwa">&lt;command</span> <span class="hl kwb">prompt</span>=<span class="hl str">&quot;#&quot;</span><span class="hl kwa">&gt;&lt;pre&gt;&lt;prompt/&gt; &lt;contents/&gt;&lt;more/&gt;&lt;/pre&gt;&lt;/command&gt;</span>
...
<span class="hl kwa">&lt;contents&gt;</span>
.... <span class="hl kwa">&lt;command&gt;</span>ls -l<span class="hl kwa">&lt;/command&gt;</span>
<span class="hl kwa">&lt;/contents&gt;</span>
<span class="hl kwa">&lt;/page&gt;</span></pre>
<p>
Here we define a function <span class="icode"><span class="hl kwa">&lt;command&gt;</span></span> which allows to put some
XML into a <span class="icode"><span class="hl kwa">&lt;pre/&gt;</span></span> node, with a prompt before.
<span class="icode"><span class="hl kwa">&lt;contents/&gt;</span></span> is used to insert the &quot;contents&quot; parameter of the function,
that is the subnodes of the <span class="icode"><span class="hl kwa">&lt;command&gt;</span></span> node.
</p>
<p>So <span class="icode"><span class="hl kwa">&lt;command&gt;</span>ls -l<span class="hl kwa">&lt;/command&gt;</span></span> will be rewritten to
<span class="icode"><span class="hl kwa">&lt;pre&gt;</span># ls -l<span class="hl kwa">&lt;/pre&gt;</span></span>.
</p>
<p>
<span class="icode">prompt</span> is an argument for <span class="icode"><span class="hl kwa">&lt;command/&gt;</span></span>, with a default
value set to &quot;# &quot;. This argument can be changed when &quot;calling&quot; the function:
</p>
<pre class="code-xml">... <span class="hl kwa">&lt;command</span> <span class="hl kwb">prompt</span>=<span class="hl str">&quot;mysql&amp;gt;&quot;</span><span class="hl kwa">&gt;</span>select * from table<span class="hl kwa">&lt;/command&gt;</span> ...</pre>
<p>will be rewritten to</p>
<pre class="code-xml">... <span class="hl kwa">&lt;pre&gt;</span>mysql<span class="hl kwd">&amp;gt;</span> select * from table<span class="hl kwa">&lt;/pre&gt;</span> ...</pre>
<p>
Only attributes of the <span class="icode"><span class="hl kwa">&lt;command/&gt;</span></span> nodes which are
&quot;declared&quot; in the rule attribute list are added to the environment used
when applying the <span class="icode"><span class="hl kwa">&lt;command&gt;</span></span> rule.
</p>
<p>It is not unusual to declare only one dummy parameter to create a function
so that <span class="icode"><span class="hl kwa">&lt;contents/&gt;</span></span> can be used in the rule body, this way:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;page</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;....&quot;</span> <span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span>  ... <span class="hl kwa">&gt;</span>
...
<span class="hl kwa">&lt;emph</span> <span class="hl kwb">foo</span>=<span class="hl str">&quot;&quot;</span><span class="hl kwa">&gt;&lt;b&gt;&lt;i&gt;&lt;contents/&gt;&lt;/i&gt;&lt;/b&gt;</span>
...
<span class="hl kwa">&lt;contents&gt;</span>
  ... <span class="hl kwa">&lt;emph&gt;</span>bla bla<span class="hl kwa">&lt;/emph&gt;</span> ...
<span class="hl kwa">&lt;/contents&gt;</span>
<span class="hl kwa">&lt;/page&gt;</span></pre>

<p>
To define functions available for all elements, you have to define them in
the main element and prefix their name with &quot;stog:&quot;, like &quot;stog:command&quot;. Then,
the <span class="icode"><span class="hl kwa">&lt;command&gt;</span></span> rule will be available in all elements; besides
it can be redefined in an element to change this rule for this element only.
</p>
</div>






<div>
    <p class="alert alert-info">
    For information you can see the <a href="#pagesource"> source code of the page</a>.
    </p>
    <div id="pagesource">
      <pre class="code-xml"><span class="hl kwa">&lt;page</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Getting started&quot;</span>
<span class="hl kwb">navbar-doc</span>=<span class="hl str">&quot;active&quot;</span>
<span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span>
<span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;command</span> <span class="hl kwb">prompt</span>=<span class="hl str">&quot;#&quot;</span><span class="hl kwa">&gt;&lt;pre&gt;&lt;prompt/&gt; &lt;contents/&gt;&lt;/pre&gt;&lt;/command&gt;</span>
<span class="hl kwa">&lt;contents&gt;</span>
<span class="hl kwa">&lt;prepare-toc</span> <span class="hl kwb">depth</span>=<span class="hl str">&quot;1&quot;</span><span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;toc&gt;</span>Sections:<span class="hl kwa">&lt;/toc&gt;</span>

<span class="hl kwa">&lt;section</span> <span class="hl kwb">id</span>=<span class="hl str">&quot;principle&quot;</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Principle&quot;</span><span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
When launched on a given root directory, <span class="hl kwa">&lt;icode&gt;</span>stog<span class="hl kwa">&lt;/icode&gt;</span> will read all files
and directories
from this starting point and generate the same hierarchy in the output directory.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
Some of the files will be read as <span class="hl kwa">&lt;i&gt;</span>elements<span class="hl kwa">&lt;/i&gt;</span>, i.e. xml files which will
be processed through a templating engine to produce the final file.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
The <span class="hl kwa">&lt;icode&gt;</span>.stog<span class="hl kwa">&lt;/icode&gt;</span> directory in the given root directory contains the
templates (in directory <span class="hl kwa">&lt;icode&gt;</span>templates<span class="hl kwa">&lt;/icode&gt;</span>) and the
<span class="hl kwa">&lt;icode&gt;</span>config<span class="hl kwa">&lt;/icode&gt;</span> file, containing stog configuration. In this file,
using regular expressions, one can indicate which files must be ignored,
and which files are elements. Files not being ignored nor being elements
will be copied by <span class="hl kwa">&lt;icode&gt;</span>stog<span class="hl kwa">&lt;/icode&gt;</span> in the target directory.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
Here is an example of <span class="hl kwa">&lt;icode&gt;</span>.stog/config<span class="hl kwa">&lt;/icode&gt;</span> file:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;hcode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;ocaml&quot;</span> <span class="hl kwb">defer_</span>=<span class="hl str">&quot;1&quot;</span><span class="hl kwa">&gt;&lt;include</span> <span class="hl kwb">file</span>=<span class="hl str">&quot;./.stog/config&quot;</span> <span class="hl kwb">raw</span>=<span class="hl str">&quot;true&quot;</span> <span class="hl kwb">depend</span>=<span class="hl str">&quot;false&quot;</span><span class="hl kwa">/&gt;&lt;/hcode&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
A default file is generated by <span class="hl kwa">&lt;icode&gt;</span>stog<span class="hl kwa">&lt;/icode&gt;</span> if it does not exist.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
When launched, <span class="hl kwa">&lt;icode&gt;</span>stog<span class="hl kwa">&lt;/icode&gt;</span> performs the following actions:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;ol&gt;</span>
<span class="hl kwa">&lt;li&gt;</span>Read the given directory hierarachy;<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;</span>Create the output directory;<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;</span>Generate element files in this directory;<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;</span>Copy all other files in the target directory, of course
  keeping the source directory structure.<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;/ol&gt;</span>
<span class="hl kwa">&lt;/section&gt;</span>

<span class="hl kwa">&lt;section</span> <span class="hl kwb">id</span>=<span class="hl str">&quot;elements&quot;</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Stog elements&quot;</span><span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
An element is an Xml tree, defined in a file matched by the regular expressions
given in the configuration file. It has one of the following forms. First form:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;hcode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span>
&lt;![CDATA[<span class="hl kwa">&lt;type</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Element title&quot;</span>
 <span class="hl kwb">attribute</span>=<span class="hl str">&quot;value&quot;</span>
 <span class="hl kwb">attribute2</span>=<span class="hl str">&quot;value2&quot;</span>
 ...
<span class="hl kwa">&gt;</span>
Here is the body of the element.
<span class="hl kwa">&lt;/type&gt;</span>
]]<span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;/hcode&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>Second form, almost the same, except that <span class="hl kwa">&lt;icode&gt;</span><span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span><span class="hl kwa">&lt;/icode&gt;</span>
indicates that more attributes are given in subnodes, and the body is in the
<span class="hl kwa">&lt;icode&gt;</span>contents<span class="hl kwa">&lt;/icode&gt;</span> subnode:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;hcode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span>
&lt;![CDATA[<span class="hl kwa">&lt;type</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Element title&quot;</span>
 <span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span>
 <span class="hl kwb">attribute</span>=<span class="hl str">&quot;value&quot;</span>
 ...
<span class="hl kwa">&gt;</span>
 <span class="hl kwa">&lt;attribute2&gt;</span>value2<span class="hl kwa">&lt;/attribute2&gt;</span>
 ...
 <span class="hl kwa">&lt;contents&gt;</span>Here is the body of the element.<span class="hl kwa">&lt;/contents&gt;</span>
<span class="hl kwa">&lt;/type&gt;</span>
]]<span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;/hcode&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
<span class="hl kwa">&lt;icode&gt;</span>type<span class="hl kwa">&lt;/icode&gt;</span> can be any string (like <span class="hl str">&quot;post&quot;</span>, <span class="hl str">&quot;page&quot;</span>, ...) and defines the type
of the element. This allows different treatements according to the element type.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
You can specify any attribute for an element. Some attributes are used
internally:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;ul&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>title<span class="hl kwa">&lt;/b&gt;</span>: this is the title of the element; use <span class="hl kwa">&lt;icode&gt;</span><span class="hl kwd">&amp;lt;</span>elt-title/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span>
in templates to access it,<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>keywords<span class="hl kwa">&lt;/b&gt;</span>: the list of comma-separated keywords associated to the element;
use <span class="hl kwa">&lt;icode&gt;</span><span class="hl kwd">&amp;lt;</span>elt-keywords/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span> in templates to insert the list of keywords
with links to by-keyword index,<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>topics<span class="hl kwa">&lt;/b&gt;</span>: same as keywords, but for topics (access with <span class="hl kwa">&lt;icode&gt;</span><span class="hl kwd">&amp;lt;</span>elt-topics/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span>),<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>date<span class="hl kwa">&lt;/b&gt;</span>: the element date, used for sorting in list. The date in specified in
the form <span class="hl kwa">&lt;i&gt;</span>YYYY/MM/DD<span class="hl kwa">&lt;/i&gt;</span>. Use <span class="hl kwa">&lt;icode&gt;</span><span class="hl kwd">&amp;lt;</span>elt-date/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span> in templates to insert it,<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>published<span class="hl kwa">&lt;/b&gt;</span>: can be set to <span class="hl kwa">&lt;i&gt;</span>false<span class="hl kwa">&lt;/i&gt;</span> to prevent the element from being generated;
useful when an element is not ready yet for publication,<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>sets<span class="hl kwa">&lt;/b&gt;</span>: a comma-separated list of set names; sets can be used to list elements
belonging to a set,<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>language-dep<span class="hl kwa">&lt;/b&gt;</span>: can be set to <span class="hl kwa">&lt;i&gt;</span>false<span class="hl kwa">&lt;/i&gt;</span> to indicate that this page is not
language dependent, when generating multi-language sites (this affects the name of the
generated file),<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>doctype<span class="hl kwa">&lt;/b&gt;</span>: specify the doctype which will be printed into the final XML file. Default is <span class="hl str">&quot;HTML&quot;</span>.<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;/ul&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
Any other attribute will be available by its name in the environment when processing the template
associated to the element type. The element type can be accessed with <span class="hl kwa">&lt;icode&gt;</span><span class="hl kwd">&amp;lt;</span>elt-type/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span>.
More details in <span class="hl kwa">&lt;elt</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;#functions&quot;</span><span class="hl kwa">&gt;&lt;/elt&gt;</span>.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
To generate the file corresponding to an element, <span class="hl kwa">&lt;icode&gt;</span>stog<span class="hl kwa">&lt;/icode&gt;</span> will use the type of
the element (for example <span class="hl str">&quot;post&quot;</span>) to load the associated template (for example <span class="hl str">&quot;post.tmpl&quot;</span> in
the templates directory).
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>You can have a look at the source of the pages of this site at the bottom of each page.
The sources of this site can be a good starting point. You can browse it in the
<span class="hl kwa">&lt;ext-a</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;https://github.com/zoggy/stog/tree/master/doc&quot;</span><span class="hl kwa">&gt;</span>doc directory of the
distribution<span class="hl kwa">&lt;/ext-a&gt;</span>.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;/section&gt;</span>

<span class="hl kwa">&lt;section</span> <span class="hl kwb">id</span>=<span class="hl str">&quot;mainelement&quot;</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Stog main element&quot;</span><span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
One element is called the main element. This element is a regular
element with the <span class="hl kwa">&lt;icode&gt;</span>main<span class="hl kwa">&lt;/icode&gt;</span> attribute set to <span class="hl str">&quot;true&quot;</span>. There can be only
one main element.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
Some attributes of this main element are used to specify site-wide information:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;ul&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>title<span class="hl kwa">&lt;/b&gt;</span>: The title of the blog is the same as this element and can be accessed
with <span class="hl kwd">&amp;lt;</span>site-title/<span class="hl kwd">&amp;gt;</span> in templates,<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>stog:site-description<span class="hl kwa">&lt;/b&gt;</span>: A short description of the site; use <span class="hl kwd">&amp;lt;</span>site-description/<span class="hl kwd">&amp;gt;</span>
to access it in templates;<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>stog:site-url<span class="hl kwa">&lt;/b&gt;</span>: The base url of the site, used to forge urls when generating pages;
use <span class="hl kwd">&amp;lt;</span>site-url/<span class="hl kwd">&amp;gt;</span> to insert it in templates,<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>stog:site-email<span class="hl kwa">&lt;/b&gt;</span>: A contact email for the site, accessible with <span class="hl kwd">&amp;lt;</span>site-email/<span class="hl kwd">&amp;gt;</span>,<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;li&gt;&lt;b&gt;</span>stog:rss-length<span class="hl kwa">&lt;/b&gt;</span>: The default length of RSS feeds.<span class="hl kwa">&lt;/li&gt;</span>
<span class="hl kwa">&lt;/ul&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
In the main element, any attribute beginning with <span class="hl str">&quot;stog:&quot;</span> will be used as global attribute
and accessible in all templates by its name. Other attributes are associated to the element only.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;/section&gt;</span>

<span class="hl kwa">&lt;section</span> <span class="hl kwb">id</span>=<span class="hl str">&quot;running&quot;</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Running Stog&quot;</span><span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
To compile your web site, use the following command:
<span class="hl kwa">&lt;command-line&gt;</span>&lt;![CDATA[stog <span class="hl kwa">&lt;root-directory&gt;</span>]]<span class="hl kwa">&gt;&lt;/command-line&gt;</span>
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>Stog will generate your web site in <span class="hl kwa">&lt;icode&gt;</span>./stog-output<span class="hl kwa">&lt;/icode&gt;</span>,
except if you use the <span class="hl kwa">&lt;icode&gt;</span>-d<span class="hl kwa">&lt;/icode&gt;</span> option to specify another
output directory.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>You can specify a template directory with the <span class="hl kwa">&lt;icode&gt;</span>--tmpl<span class="hl kwa">&lt;/icode&gt;</span>
option. By default, the templates are searched in the <span class="hl kwa">&lt;icode&gt;</span>.stog/templates<span class="hl kwa">&lt;/icode&gt;</span> directory
of the specified root directory.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
It is possible to give more than one directory to <span class="hl kwa">&lt;icode&gt;</span>stog<span class="hl kwa">&lt;/icode&gt;</span>. In this case,
all pages and articles are merged as if all were defined in the last directory
given. It may be useful to gather blogs or page to generate one big site. Or not.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>The <span class="hl kwa">&lt;icode&gt;</span>--site-url<span class="hl kwa">&lt;/icode&gt;</span> option is used to override the <span class="hl kwa">&lt;icode&gt;</span>stog:site-url<span class="hl kwa">&lt;/icode&gt;</span>
field of the main element. It it useful to generate a local site, for example
<span class="hl kwa">&lt;command-line&gt;</span>stog --site-url file:///tmp/website your-directory<span class="hl kwa">&lt;/command-line&gt;</span>
to test your site locally with correct links.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>The <span class="hl kwa">&lt;icode&gt;</span>--plugin<span class="hl kwa">&lt;/icode&gt;</span> option makes <span class="hl kwa">&lt;icode&gt;</span>stog<span class="hl kwa">&lt;/icode&gt;</span> dynamically
load the given OCaml object file. The loaded plugin can define new functions
to associate to some tags, or even override some pre-defined functions.
See <span class="hl kwa">&lt;page</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;plugins&quot;</span><span class="hl kwa">/&gt;</span>.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
If a plugin was installed with ocamlfind, the <span class="hl kwa">&lt;icode&gt;</span>--package<span class="hl kwa">&lt;/icode&gt;</span> option can be used
to specify a list of comma-separated packages to load. <span class="hl kwa">&lt;icode&gt;</span>ocamlfind<span class="hl kwa">&lt;/icode&gt;</span> will
then be used to get the location and required files to load these packages, in bytecode
for <span class="hl kwa">&lt;icode&gt;</span>stog.byte<span class="hl kwa">&lt;/icode&gt;</span> or native-code for <span class="hl kwa">&lt;icode&gt;</span>stog<span class="hl kwa">&lt;/icode&gt;</span>.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>At last, the <span class="hl kwa">&lt;icode&gt;</span>--lang<span class="hl kwa">&lt;/icode&gt;</span> option is used to generate the website
for one language. By default, the only known languages are <span class="hl str">&quot;en&quot;</span> and <span class="hl str">&quot;fr&quot;</span>.
If you use the <span class="hl kwa">&lt;icode&gt;</span>--lang en<span class="hl kwa">&lt;/icode&gt;</span> option, then pages will be generated
in <span class="hl kwa">&lt;icode&gt;</span>.en.html<span class="hl kwa">&lt;/icode&gt;</span> files and all <span class="hl kwa">&lt;icode&gt;</span><span class="hl kwd">&amp;lt;</span>fr<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span> nodes will be removed.
Then you can run <span class="hl kwa">&lt;icode&gt;</span>stog<span class="hl kwa">&lt;/icode&gt;</span> with the <span class="hl kwa">&lt;icode&gt;</span>--lang fr<span class="hl kwa">&lt;/icode&gt;</span>
to generate the <span class="hl str">&quot;fr&quot;</span> part of your web site, removing all <span class="hl kwa">&lt;icode&gt;</span><span class="hl kwd">&amp;lt;</span>en<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span>.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl com">&lt;!--</span>
<span class="hl com">&lt;p&gt;</span>
<span class="hl com">If you need more languages, just define &quot;stog:languages&quot; in the main element</span>
<span class="hl com">this way:</span>
<span class="hl com">&lt;/p&gt;</span>
<span class="hl com">&lt;hcode&gt;&lt;![CDATA[&lt;type main=&quot;true&quot; ... stog:languages=&quot;es,de,fr,en&quot;&gt;...&lt;/type&gt;]]&gt;&lt;/hcode&gt;</span>
<span class="hl com">&lt;p&gt;This makes &amp;lt;languages/&amp;gt; returning the list of languages, and it is used by</span>
<span class="hl com">the provided</span>
<span class="hl com">--&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
Stog will keep computed elements in directory <span class="hl kwa">&lt;code&gt;</span>.stog/cache<span class="hl kwa">&lt;/code&gt;</span>.
To prevent stog from using this cache, use the <span class="hl kwa">&lt;code&gt;</span>--nocache<span class="hl kwa">&lt;/code&gt;</span>
command line option. The cache won't be read, but it will nevertheless
be updated by contents of computed elements.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
The caching strategy uses dependencies between elements: if an element
refers to another one (see <span class="hl kwa">&lt;elt</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;funs&quot;</span><span class="hl kwa">/&gt;</span>), a dependency will be
added and stored in the cache directory, so that this dependency will
be used during the next run of stog. An element can also depend
on files: the templates used, the files included, ... Dependencies are
recursively computed.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
In some cases, using recursive dependencies may be too complete. For example,
if you have a menubar appearing in all pages, all pages will depend on
the elements referenced by the menubar, leading to all elements depending
on all elements. A change in any element will then make every element recomputed
at each run. To prevent this, the <span class="hl kwa">&lt;code&gt;</span>--depcut<span class="hl kwa">&lt;/code&gt;</span> option specifies
to use non-recursive dependencies in the caching strategy.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
A convenient way to use stog is to create a Makefile with different targets,
to generate your site for a local test and for online publishing.
Have a look at <span class="hl kwa">&lt;ext-a</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;https://github.com/zoggy/stog/tree/master/doc/Makefile&quot;</span><span class="hl kwa">&gt;</span>this
Makefile<span class="hl kwa">&lt;/ext-a&gt;</span> used to build stog documentation.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;/section&gt;</span>

<span class="hl kwa">&lt;section</span> <span class="hl kwb">id</span>=<span class="hl str">&quot;templates&quot;</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Evaluation and templating&quot;</span><span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
The final files corresponding to elements are built the following way.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>Various rewrite levels are defined in Stog, and plugins can add more levels.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>A level is composed of a list of functions, each function taking an element
and returning the (eventually modified) element. Pre-defined levels are composed
of functions applying rewrite rules to element body.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>Various levels are required to ensure some rules will be applied after
others, for example to verify cross-element links. Each level has a number,
and levels are applied in order from <span class="hl num">0</span> to n. Pre-defined levels are
numbered like lines in BASIC programs: <span class="hl num">0</span>, <span class="hl num">50</span>, <span class="hl num">100</span>, <span class="hl num">120</span>, ... making
plugins able to insert new levels.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>The first application of a level to an element uses the
type of the element to load the corresponding template; for example,
if the element has type <span class="hl str">&quot;page&quot;</span>, then a template <span class="hl kwa">&lt;icode&gt;</span>page.tmpl<span class="hl kwa">&lt;/icode&gt;</span> will
be looked for.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>An environment is built containing the
<span class="hl kwa">&lt;a</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;#mainelement&quot;</span><span class="hl kwa">&gt;</span>site-wide attributes<span class="hl kwa">&lt;/a&gt;</span> and the element attributes.
This environment is a set of rewrite rules.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>In each level, each function of the level is applied to the element current body
(the <span class="hl str">&quot;first current body&quot;</span> is the template, where <span class="hl kwa">&lt;icode&gt;</span><span class="hl kwd">&amp;lt;</span>elt-body/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span> will be
rewritten to the tree of the element body as given in the element file).
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>The pre-defined levels contain pre-defined functions which apply
<span class="hl kwa">&lt;page</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;funs&quot;</span><span class="hl kwa">&gt;</span>default rules<span class="hl kwa">&lt;/page&gt;</span>, in addition to the rules from
the environment and rules added by plugins.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>When all levels were applied to elements, the contents of each element
is stored in the cache (the <span class="hl kwa">&lt;icode&gt;</span>.stog/cache<span class="hl kwa">&lt;/icode&gt;</span> directory).
The final XML file is also created from this contents.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>Remark: If the element file was not modified since the corresponding
cache file was stored, nor its dependencies (see <span class="hl kwa">&lt;elt</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;#running&quot;</span><span class="hl kwa">/&gt;</span>),
the contents of the element is read back from
the cache, and the level functions are not applied to this element.
<span class="hl kwa">&lt;/p&gt;</span>

<span class="hl kwa">&lt;p&gt;</span>The environment is used in the following way.
For each encountered node with tag <span class="hl kwa">&lt;icode&gt;</span>t<span class="hl kwa">&lt;/icode&gt;</span>, <span class="hl kwa">&lt;icode&gt;</span>t<span class="hl kwa">&lt;/icode&gt;</span> is looked up
in the environment for its associated <span class="hl kwa">&lt;em&gt;</span>function<span class="hl kwa">&lt;/em&gt; &lt;icode&gt;</span>f<span class="hl kwa">&lt;/icode&gt;</span>.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>If no <span class="hl kwa">&lt;icode&gt;</span>f<span class="hl kwa">&lt;/icode&gt;</span> is found, then the XML node is left untouched
and the children of the node are then analysed.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>If <span class="hl kwa">&lt;icode&gt;</span>f<span class="hl kwa">&lt;/icode&gt;</span> is found, then it is called, given the environment,
the attributes and the children of the node. Then the function returns
a list of XML trees which must then be analysed.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>When this analyze reaches a fixpoint, the final XML is returned.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>This work is performed by the <span class="hl kwa">&lt;ext-a</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;https://github.com/zoggy/xtmpl&quot;</span><span class="hl kwa">&gt;</span>Xtmpl<span class="hl kwa">&lt;/ext-a&gt;</span>
library.<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>Besides, the contents of the attributes are also analysed to perform such substitutions,
before looking up for the tag in the environment.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>Stog comes with <span class="hl kwa">&lt;page</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;funs&quot;</span><span class="hl kwa">&gt;</span>predefined functions<span class="hl kwa">&lt;/page&gt;</span>
associated to some tags, but more can be created in
<span class="hl kwa">&lt;elt</span> <span class="hl kwb">href</span>=<span class="hl str">&quot;plugins&quot;</span><span class="hl kwa">&gt;</span>plugins<span class="hl kwa">&lt;/elt&gt;</span>.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;/section&gt;</span>

<span class="hl kwa">&lt;section</span> <span class="hl kwb">id</span>=<span class="hl str">&quot;functions&quot;</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;Attributes and functions&quot;</span><span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
When defining elements, you can add attributes, which will be added
to the base environment when applying level functions to this element.
For example:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;hcode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span>&lt;![CDATA[<span class="hl kwa">&lt;page</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;....&quot;</span>
...
<span class="hl kwb">author</span>=<span class="hl str">&quot;Santa Claus&quot;</span>
<span class="hl kwa">&gt;</span>
.... <span class="hl kwa">&lt;author/&gt;</span> ....
<span class="hl kwa">&lt;/page&gt;</span>]]<span class="hl kwa">&gt;&lt;/hcode&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
Here the node <span class="hl kwa">&lt;icode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span><span class="hl kwd">&amp;lt;</span>author/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span> will we rewritten to
<span class="hl str">&quot;Santa Claus&quot;</span> (without quotes).
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>The same can be achieved for more complex nodes, using the
<span class="hl kwa">&lt;icode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span><span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span><span class="hl kwa">&lt;/icode&gt;</span>
attribute:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;hcode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span>&lt;![CDATA[<span class="hl kwa">&lt;page</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;....&quot;</span>
  <span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span>
  ...
<span class="hl kwa">&gt;</span>
<span class="hl kwa">&lt;author&gt;&lt;b&gt;</span>Santa Claus<span class="hl kwa">&lt;/b&gt;&lt;/author&gt;</span>
<span class="hl kwa">&lt;contents&gt;</span>
.... <span class="hl kwa">&lt;author/&gt;</span> ....
<span class="hl kwa">&lt;/contents&gt;</span>
<span class="hl kwa">&lt;/page&gt;</span>]]<span class="hl kwa">&gt;&lt;/hcode&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>here <span class="hl kwa">&lt;icode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span><span class="hl kwd">&amp;lt;</span>author/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span> will we rewritten to
<span class="hl kwa">&lt;icode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span><span class="hl kwd">&amp;lt;</span>b<span class="hl kwd">&amp;gt;</span>Santa Claus<span class="hl kwd">&amp;lt;</span>/b<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/icode&gt;</span>.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
You can also define functions. A function is defined like an attribute
when having <span class="hl kwa">&lt;icode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span><span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span><span class="hl kwa">&lt;/icode&gt;</span>, except the
node defining the name of the function has XML attributes:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;hcode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span>&lt;![CDATA[<span class="hl kwa">&lt;page</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;....&quot;</span>
  <span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span>
  ...
<span class="hl kwa">&gt;</span>
...
<span class="hl kwa">&lt;command</span> <span class="hl kwb">prompt</span>=<span class="hl str">&quot;#&quot;</span><span class="hl kwa">&gt;&lt;pre&gt;&lt;prompt/&gt; &lt;contents/&gt;&lt;more/&gt;&lt;/pre&gt;&lt;/command&gt;</span>
...
<span class="hl kwa">&lt;contents&gt;</span>
.... <span class="hl kwa">&lt;command&gt;</span>ls -l<span class="hl kwa">&lt;/command&gt;</span>
<span class="hl kwa">&lt;/contents&gt;</span>
<span class="hl kwa">&lt;/page&gt;</span>]]<span class="hl kwa">&gt;&lt;/hcode&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
Here we define a function <span class="hl kwa">&lt;ixml&gt;</span><span class="hl kwd">&amp;lt;</span>command<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/ixml&gt;</span> which allows to put some
XML into a <span class="hl kwa">&lt;ixml&gt;&lt;pre/&gt;&lt;/ixml&gt;</span> node, with a prompt before.
<span class="hl kwa">&lt;ixml&gt;</span><span class="hl kwd">&amp;lt;</span>contents/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/ixml&gt;</span> is used to insert the <span class="hl str">&quot;contents&quot;</span> parameter of the function,
that is the subnodes of the <span class="hl kwa">&lt;ixml&gt;</span><span class="hl kwd">&amp;lt;</span>command<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/ixml&gt;</span> node.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>So <span class="hl kwa">&lt;icode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;&lt;command&gt;</span>ls -l<span class="hl kwa">&lt;/command&gt;&lt;/icode&gt;</span> will be rewritten to
<span class="hl kwa">&lt;ixml&gt;&lt;command&gt;</span>ls -l<span class="hl kwa">&lt;/command&gt;&lt;/ixml&gt;</span>.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
<span class="hl kwa">&lt;icode&gt;</span>prompt<span class="hl kwa">&lt;/icode&gt;</span> is an argument for <span class="hl kwa">&lt;icode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;&lt;command/&gt;&lt;/icode&gt;</span>, with a default
value set to <span class="hl str">&quot;# &quot;</span>. This argument can be changed when <span class="hl str">&quot;calling&quot;</span> the function:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;hcode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span>... <span class="hl kwa">&lt;command</span> <span class="hl kwb">prompt</span>=<span class="hl str">&quot;mysql&amp;gt; &quot;</span><span class="hl kwa">&gt;</span>select * from table<span class="hl kwa">&lt;/command&gt;</span> ...<span class="hl kwa">&lt;/hcode&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>will be rewritten to<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;hcode</span> <span class="hl kwb">defer_</span>=<span class="hl str">&quot;1&quot;</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span>... <span class="hl kwa">&lt;command</span> <span class="hl kwb">prompt</span>=<span class="hl str">&quot;mysql&amp;gt; &quot;</span><span class="hl kwa">&gt;</span>select * from table<span class="hl kwa">&lt;/command&gt;</span> ...<span class="hl kwa">&lt;/hcode&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>
Only attributes of the <span class="hl kwa">&lt;ixml&gt;</span><span class="hl kwd">&amp;lt;</span>command/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/ixml&gt;</span> nodes which are
<span class="hl str">&quot;declared&quot;</span> in the rule attribute list are added to the environment used
when applying the <span class="hl kwa">&lt;ixml&gt;</span><span class="hl kwd">&amp;lt;</span>command<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/ixml&gt;</span> rule.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;p&gt;</span>It is not unusual to declare only one dummy parameter to create a function
so that <span class="hl kwa">&lt;ixml&gt;</span><span class="hl kwd">&amp;lt;</span>contents/<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/ixml&gt;</span> can be used in the rule body, this way:
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;hcode</span> <span class="hl kwb">lang</span>=<span class="hl str">&quot;xml&quot;</span><span class="hl kwa">&gt;</span>&lt;![CDATA[<span class="hl kwa">&lt;page</span> <span class="hl kwb">title</span>=<span class="hl str">&quot;....&quot;</span> <span class="hl kwb">with-contents</span>=<span class="hl str">&quot;true&quot;</span>  ... <span class="hl kwa">&gt;</span>
...
<span class="hl kwa">&lt;emph</span> <span class="hl kwb">foo</span>=<span class="hl str">&quot;&quot;</span><span class="hl kwa">&gt;&lt;b&gt;&lt;i&gt;&lt;contents/&gt;&lt;/i&gt;&lt;/b&gt;</span>
...
<span class="hl kwa">&lt;contents&gt;</span>
  ... <span class="hl kwa">&lt;emph&gt;</span>bla bla<span class="hl kwa">&lt;/emph&gt;</span> ...
<span class="hl kwa">&lt;/contents&gt;</span>
<span class="hl kwa">&lt;/page&gt;</span>]]<span class="hl kwa">&gt;&lt;/hcode&gt;</span>

<span class="hl kwa">&lt;p&gt;</span>
To define functions available for all elements, you have to define them in
the main element and prefix their name with <span class="hl str">&quot;stog:&quot;</span>, like <span class="hl str">&quot;stog:command&quot;</span>. Then,
the <span class="hl kwa">&lt;ixml&gt;</span><span class="hl kwd">&amp;lt;</span>command<span class="hl kwd">&amp;gt;</span><span class="hl kwa">&lt;/ixml&gt;</span> rule will be available in all elements; besides
it can be redefined in an element to change this rule for this element only.
<span class="hl kwa">&lt;/p&gt;</span>
<span class="hl kwa">&lt;/section&gt;</span>

<span class="hl kwa">&lt;/prepare-toc&gt;</span>
<span class="hl kwa">&lt;/contents&gt;</span>
<span class="hl kwa">&lt;/page&gt;</span></pre>
    </div>
  </div>

</div> 

<footer id="bottombar"/>
</body>
</html>