<!DOCTYPE HTML>
<html>
<head>
<title>Stog : OCaml sessions</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="stylesheet" type="text/css" href="http://zoggy.github.com/stog/style.css"/>
</head><body>
<div id="page">
<div class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">


  <ul class="nav">
    <li class="&lt;navbar-home/&gt;"><a href="http://zoggy.github.com/stog/index.html">Stog</a></li>
    <li class="&lt;navbar-install/&gt;"><a href="http://zoggy.github.com/stog/install.html">Installation</a></li>
    <li class="&lt;navbar-doc/&gt;"><a href="http://zoggy.github.com/stog/doc.html">Documentation</a></li>
    <li class="active"><a href="http://zoggy.github.com/stog/blog.html">Blog</a></li>
    <li class="&lt;navbar-about/&gt;"><a href="http://zoggy.github.com/stog/about.html">?</a></li>
  </ul>
  <div class="nav pull-right">

  </div>

</div>
</div>
</div>

<div id="header">
<div class="elt-navbar"><div class="navleft"><a href="http://zoggy.github.com/stog/posts/release-0.3.html">Stog 0.3</a></div><div class="navright"><a href="http://zoggy.github.com/stog/posts/release-0.4.html">Stog 0.4</a></div></div>
<div class="page-title">OCaml sessions</div>
</div>
<span/>
<div class="date">November 21, 2012</div>

<p>
A <a href="http://zoggy.github.com/stog/posts/displaying-evaluated-ocaml-code.html">previous post</a>
introduced the <span class="icode">&lt;ocaml-eval&gt;</span> function to
evaluate ocaml code, enventually displaying the result in a toplevel way, etc.
</p>
<p>
OCaml code was evaluated in the Stog process, which required Stog to
embed the OCaml toplevel, only available as bytecode. As a consequence,
only the bytecode version of Stog could evaluate OCaml code using the
internal toplevel.
</p>

<p>
Since release 0.4 of Stog, the evaluation of OCaml has been moved
to an external program, <span class="icode">ocaml-ocaml-session</span>.
This program is launched by Stog when OCaml code has to be evaluated.
Stog and this program communicate OCaml values through a pipe
(see <a href="../ref-doc/Stog_ocaml_types.html">Stog_ocaml_types</a> module
for details).
</p>
<p>Of course, an instance of <span class="icode">stog-ocaml-session</span> is
not launched each time an OCaml phrase has be to evaluated.
Instead, Stog keeps a list of &quot;ocaml sessions&quot;, each session corresponding
to a <span class="icode">stog-ocaml-session</span> process.
</p>
<p>That allows two cool things:</p>
<ul>
<li>the <span class="icode">&lt;ocaml-eval&gt;</span> function is available in native code
  version of Stog,</li>
<li>more than one session can be used when evaluating the code to show in
the generated pages. For example, there can be one ocaml session per
blog post, to prevent namespace pollution from one post to another.
</li>
</ul>
<p>The default ocaml session is called &quot;default&quot;. The session name to
use to evaluate OCaml code can be specified using the &quot;session&quot; attribute
of  <span class="icode">&lt;ocaml-eval&gt;</span>.
</p>
<p>Here is an example.</p>
<pre class="code-xml"><span class="hl kwa">&lt;ocaml-eval</span> <span class="hl kwb">toplevel</span>=<span class="hl str">&quot;true&quot;</span><span class="hl kwa">&gt;</span>let x = <span class="hl num">1</span>;;<span class="hl kwa">&lt;/ocaml-eval&gt;</span></pre>
<p>will give</p>
<pre class="code-ocaml"><div># <span class="hl kwa">let</span> x <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;;</span></div><div class="ocaml-toplevel">val x : int = 1</div></pre>
<p>Then, let's evaluate another piece of code, in the same (&quot;default&quot;) session:
</p>
<pre class="code-xml"><span class="hl kwa">&lt;ocaml-eval</span> <span class="hl kwb">toplevel</span>=<span class="hl str">&quot;true&quot;</span><span class="hl kwa">&gt;</span>let y = x + <span class="hl num">1</span>;;<span class="hl kwa">&lt;/ocaml-eval&gt;</span></pre>
will give
<pre class="code-ocaml"><div># <span class="hl kwa">let</span> y <span class="hl opt">=</span> x <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl opt">;;</span></div><div class="ocaml-toplevel">val y : int = 2</div></pre>
<p>Now, let's evaluate the same code in another session, &quot;session2&quot;:</p>
<pre class="code-xml"><span class="hl kwa">&lt;ocaml-eval</span> <span class="hl kwb">toplevel</span>=<span class="hl str">&quot;true&quot;</span> <span class="hl kwb">error-exc</span>=<span class="hl str">&quot;false&quot;</span> <span class="hl kwb">session</span>=<span class="hl str">&quot;session2&quot;</span><span class="hl kwa">&gt;</span>
let y = x + <span class="hl num">1</span>;;<span class="hl kwa">&lt;/ocaml-eval&gt;</span></pre>
<p>will result in</p>
<pre class="code-ocaml"><div># <span class="hl kwa">let</span> y <span class="hl opt">=</span> x <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl opt">;;</span></div><div class="ocaml-toplevel ocaml-exc">Line 1, characters 8-9:
Error: Unbound value x</div></pre>



<div class="comments">
<div>
<div class="elt-keywords">
  <div class="bloc-keywords">
  Topics: <div class="keywords"><a href="http://zoggy.github.com/stog/topic_stog.html"><span itemprop="keywords">stog</span></a></div>
  </div>
  <div class="bloc-keywords">
  Keywords: <div class="keywords"><a href="http://zoggy.github.com/stog/kw_ocaml.html"><span itemprop="keywords">ocaml</span></a>, <a href="http://zoggy.github.com/stog/kw_evaluation.html"><span itemprop="keywords">evaluation</span></a>, <a href="http://zoggy.github.com/stog/kw_code.html"><span itemprop="keywords">code</span></a></div>
  </div>
</div>
</div>
<div itemprop="articleSection" class="section">
  <div id="disqus_thread"/>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'stog'; // required: replace example with your forum shortname
    var disqus_url = 'http://zoggy.github.com/stog/posts/ocaml-sessions.html' ;
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

</div>
</div>

</div>

<footer id="bottombar">
</footer>
</body>
</html>